{"version":3,"file":"chunks/app_utils_sessions_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/sessions.tsx","webpack:///./app/views/releases/list/utils.tsx","webpack:///./app/views/releases/utils/index.tsx","webpack:///./app/views/releases/utils/sessionTerm.tsx"],"sourcesContent":["import compact from 'lodash/compact';\nimport mean from 'lodash/mean';\nimport moment from 'moment';\n\nimport {\n  DateTimeObject,\n  getDiffInMinutes,\n  ONE_WEEK,\n  TWO_WEEKS,\n} from 'app/components/charts/utils';\nimport {SessionApiResponse, SessionField, SessionStatus} from 'app/types';\nimport {SeriesDataUnit} from 'app/types/echarts';\nimport {defined, percent} from 'app/utils';\nimport {Theme} from 'app/utils/theme';\nimport {getCrashFreePercent, getSessionStatusPercent} from 'app/views/releases/utils';\nimport {sessionTerm} from 'app/views/releases/utils/sessionTerm';\n\nexport function getCount(groups: SessionApiResponse['groups'] = [], field: SessionField) {\n  return groups.reduce((acc, group) => acc + group.totals[field], 0);\n}\n\nexport function getCrashFreeRate(\n  groups: SessionApiResponse['groups'] = [],\n  field: SessionField\n) {\n  const crashedRate = getSessionStatusRate(groups, field, SessionStatus.CRASHED);\n\n  return defined(crashedRate) ? getCrashFreePercent(100 - crashedRate) : null;\n}\n\nexport function getSeriesAverage(\n  groups: SessionApiResponse['groups'] = [],\n  field: SessionField\n) {\n  const totalCount = getCount(groups, field);\n\n  const dataPoints = groups.filter(group => !!group.totals[field]).length;\n\n  return !defined(totalCount) || dataPoints === null || totalCount === 0\n    ? null\n    : totalCount / dataPoints;\n}\n\nexport function getSessionStatusRate(\n  groups: SessionApiResponse['groups'] = [],\n  field: SessionField,\n  status: SessionStatus\n) {\n  const totalCount = getCount(groups, field);\n\n  const crashedCount = getCount(\n    groups.filter(({by}) => by['session.status'] === status),\n    field\n  );\n\n  return !defined(totalCount) || totalCount === 0\n    ? null\n    : percent(crashedCount ?? 0, totalCount ?? 0);\n}\n\nexport function getCrashFreeRateSeries(\n  groups: SessionApiResponse['groups'] = [],\n  intervals: SessionApiResponse['intervals'] = [],\n  field: SessionField\n): SeriesDataUnit[] {\n  return compact(\n    intervals.map((interval, i) => {\n      const intervalTotalSessions = groups.reduce(\n        (acc, group) => acc + group.series[field][i],\n        0\n      );\n\n      const intervalCrashedSessions =\n        groups.find(group => group.by['session.status'] === SessionStatus.CRASHED)\n          ?.series[field][i] ?? 0;\n\n      const crashedSessionsPercent = percent(\n        intervalCrashedSessions,\n        intervalTotalSessions\n      );\n\n      if (intervalTotalSessions === 0) {\n        return null;\n      }\n\n      return {\n        name: interval,\n        value: getCrashFreePercent(100 - crashedSessionsPercent),\n      };\n    })\n  );\n}\n\nexport function getSessionStatusRateSeries(\n  groups: SessionApiResponse['groups'] = [],\n  intervals: SessionApiResponse['intervals'] = [],\n  field: SessionField,\n  status: SessionStatus\n): SeriesDataUnit[] {\n  return compact(\n    intervals.map((interval, i) => {\n      const intervalTotalSessions = groups.reduce(\n        (acc, group) => acc + group.series[field][i],\n        0\n      );\n\n      const intervalStatusSessions =\n        groups.find(group => group.by['session.status'] === status)?.series[field][i] ??\n        0;\n\n      const statusSessionsPercent = percent(\n        intervalStatusSessions,\n        intervalTotalSessions\n      );\n\n      if (intervalTotalSessions === 0) {\n        return null;\n      }\n\n      return {\n        name: interval,\n        value: getSessionStatusPercent(statusSessionsPercent),\n      };\n    })\n  );\n}\n\nexport function getSessionP50Series(\n  groups: SessionApiResponse['groups'] = [],\n  intervals: SessionApiResponse['intervals'] = [],\n  field: SessionField,\n  valueFormatter?: (value: number) => number\n): SeriesDataUnit[] {\n  return compact(\n    intervals.map((interval, i) => {\n      const meanValue = mean(\n        groups.map(group => group.series[field][i]).filter(v => !!v)\n      );\n\n      if (!meanValue) {\n        return null;\n      }\n\n      return {\n        name: interval,\n        value:\n          typeof valueFormatter === 'function' ? valueFormatter(meanValue) : meanValue,\n      };\n    })\n  );\n}\n\nexport function getAdoptionSeries(\n  releaseGroups: SessionApiResponse['groups'] = [],\n  allGroups: SessionApiResponse['groups'] = [],\n  intervals: SessionApiResponse['intervals'] = [],\n  field: SessionField\n): SeriesDataUnit[] {\n  return intervals.map((interval, i) => {\n    const intervalReleaseSessions = releaseGroups.reduce(\n      (acc, group) => acc + (group.series[field]?.[i] ?? 0),\n      0\n    );\n    const intervalTotalSessions = allGroups.reduce(\n      (acc, group) => acc + (group.series[field]?.[i] ?? 0),\n      0\n    );\n\n    const intervalAdoption = percent(intervalReleaseSessions, intervalTotalSessions);\n\n    return {\n      name: interval,\n      value: Math.round(intervalAdoption),\n    };\n  });\n}\n\nexport function getCountSeries(\n  field: SessionField,\n  group?: SessionApiResponse['groups'][0],\n  intervals: SessionApiResponse['intervals'] = []\n): SeriesDataUnit[] {\n  return intervals.map((interval, index) => ({\n    name: interval,\n    value: group?.series[field][index] ?? 0,\n  }));\n}\n\nexport function initSessionsChart(theme: Theme) {\n  const colors = theme.charts.getColorPalette(14);\n  return {\n    [SessionStatus.HEALTHY]: {\n      seriesName: sessionTerm.healthy,\n      data: [],\n      color: theme.green300,\n      areaStyle: {\n        color: theme.green300,\n        opacity: 1,\n      },\n      lineStyle: {\n        opacity: 0,\n        width: 0.4,\n      },\n    },\n    [SessionStatus.ERRORED]: {\n      seriesName: sessionTerm.errored,\n      data: [],\n      color: colors[12],\n      areaStyle: {\n        color: colors[12],\n        opacity: 1,\n      },\n      lineStyle: {\n        opacity: 0,\n        width: 0.4,\n      },\n    },\n    [SessionStatus.ABNORMAL]: {\n      seriesName: sessionTerm.abnormal,\n      data: [],\n      color: colors[15],\n      areaStyle: {\n        color: colors[15],\n        opacity: 1,\n      },\n      lineStyle: {\n        opacity: 0,\n        width: 0.4,\n      },\n    },\n    [SessionStatus.CRASHED]: {\n      seriesName: sessionTerm.crashed,\n      data: [],\n      color: theme.red300,\n      areaStyle: {\n        color: theme.red300,\n        opacity: 1,\n      },\n      lineStyle: {\n        opacity: 0,\n        width: 0.4,\n      },\n    },\n  };\n}\n\ntype GetSessionsIntervalOptions = {\n  highFidelity?: boolean;\n};\n\nexport function getSessionsInterval(\n  datetimeObj: DateTimeObject,\n  {highFidelity}: GetSessionsIntervalOptions = {}\n) {\n  const diffInMinutes = getDiffInMinutes(datetimeObj);\n\n  if (moment(datetimeObj.start).isSameOrBefore(moment().subtract(30, 'days'))) {\n    // we cannot use sub-hour session resolution on buckets older than 30 days\n    highFidelity = false;\n  }\n\n  if (diffInMinutes > TWO_WEEKS) {\n    return '1d';\n  }\n  if (diffInMinutes > ONE_WEEK) {\n    return '6h';\n  }\n\n  // limit on backend for sub-hour session resolution is set to six hours\n  if (highFidelity && diffInMinutes < 360) {\n    if (diffInMinutes <= 30) {\n      return '1m';\n    }\n\n    return '5m';\n  }\n\n  return '1h';\n}\n\n// Sessions API can only round intervals to the closest hour - this is especially problematic when using sub-hour resolution.\n// We filter out results that are out of bounds on frontend and recalculate totals.\nexport function filterSessionsInTimeWindow(\n  sessions: SessionApiResponse,\n  start?: string,\n  end?: string\n) {\n  if (!start || !end) {\n    return sessions;\n  }\n\n  const filteredIndexes: number[] = [];\n\n  const intervals = sessions.intervals.filter((interval, index) => {\n    const isBetween = moment\n      .utc(interval)\n      .isBetween(moment.utc(start), moment.utc(end), undefined, '[]');\n    if (isBetween) {\n      filteredIndexes.push(index);\n    }\n\n    return isBetween;\n  });\n\n  const groups = sessions.groups.map(group => {\n    const series = {};\n    const totals = {};\n    Object.keys(group.series).forEach(field => {\n      totals[field] = 0;\n      series[field] = group.series[field].filter((value, index) => {\n        const isBetween = filteredIndexes.includes(index);\n        if (isBetween) {\n          totals[field] = (totals[field] ?? 0) + value;\n        }\n\n        return isBetween;\n      });\n      if (field.startsWith('p50')) {\n        totals[field] = mean(series[field]);\n      }\n      if (field.startsWith('count_unique')) {\n        /* E.g. users\n        We cannot sum here because users would not be unique anymore.\n        User can be repeated and part of multiple buckets in series but it's still that one user so totals would be wrong.\n        This operation is not 100% correct, because we are filtering series in time window but the total is for unfiltered series (it's the closest thing we can do right now) */\n        totals[field] = group.totals[field];\n      }\n    });\n    return {...group, series, totals};\n  });\n\n  return {\n    start: intervals[0],\n    end: intervals[intervals.length - 1],\n    query: sessions.query,\n    intervals,\n    groups,\n  };\n}\n","export enum SortOption {\n  CRASH_FREE_USERS = 'crash_free_users',\n  CRASH_FREE_SESSIONS = 'crash_free_sessions',\n  USERS_24_HOURS = 'users_24h',\n  SESSIONS_24_HOURS = 'sessions_24h',\n  SESSIONS = 'sessions',\n  DATE = 'date',\n  BUILD = 'build',\n  SEMVER = 'semver',\n  ADOPTION = 'adoption',\n}\n\nexport enum DisplayOption {\n  USERS = 'users',\n  SESSIONS = 'sessions',\n}\n\nexport enum StatusOption {\n  ACTIVE = 'active',\n  ARCHIVED = 'archived',\n}\n","import {Location} from 'history';\nimport pick from 'lodash/pick';\nimport round from 'lodash/round';\nimport moment from 'moment';\n\nimport {DateTimeObject} from 'app/components/charts/utils';\nimport {getParams} from 'app/components/organizations/globalSelectionHeader/getParams';\nimport {PAGE_URL_PARAM, URL_PARAM} from 'app/constants/globalSelectionHeader';\nimport {tn} from 'app/locale';\nimport {Release, ReleaseStatus} from 'app/types';\nimport {MutableSearch} from 'app/utils/tokenizeSearch';\nimport {IssueSortOptions} from 'app/views/issueList/utils';\n\nimport {DisplayOption} from '../list/utils';\n\nexport const CRASH_FREE_DECIMAL_THRESHOLD = 95;\n\nexport const roundDuration = (seconds: number) => {\n  return round(seconds, seconds > 60 ? 0 : 3);\n};\n\nexport const getCrashFreePercent = (\n  percent: number,\n  decimalThreshold = CRASH_FREE_DECIMAL_THRESHOLD,\n  decimalPlaces = 3\n): number => {\n  const roundedValue = round(percent, percent > decimalThreshold ? decimalPlaces : 0);\n  if (roundedValue === 100 && percent < 100) {\n    return (\n      Math.floor(percent * Math.pow(10, decimalPlaces)) / Math.pow(10, decimalPlaces)\n    );\n  }\n\n  return roundedValue;\n};\n\nexport const displayCrashFreePercent = (\n  percent: number,\n  decimalThreshold = CRASH_FREE_DECIMAL_THRESHOLD,\n  decimalPlaces = 3\n): string => {\n  if (isNaN(percent)) {\n    return '\\u2015';\n  }\n\n  if (percent < 1 && percent > 0) {\n    return `<1\\u0025`;\n  }\n\n  const rounded = getCrashFreePercent(\n    percent,\n    decimalThreshold,\n    decimalPlaces\n  ).toLocaleString();\n\n  return `${rounded}\\u0025`;\n};\n\nexport const getSessionStatusPercent = (percent: number, absolute = true) => {\n  return round(absolute ? Math.abs(percent) : percent, 3);\n};\n\nexport const displaySessionStatusPercent = (percent: number, absolute = true) => {\n  return `${getSessionStatusPercent(percent, absolute).toLocaleString()}\\u0025`;\n};\n\nexport const displayCrashFreeDiff = (\n  diffPercent: number,\n  crashFreePercent?: number | null\n) =>\n  `${Math.abs(\n    round(\n      diffPercent,\n      crashFreePercent && crashFreePercent > CRASH_FREE_DECIMAL_THRESHOLD ? 3 : 0\n    )\n  ).toLocaleString()}\\u0025`;\n\nexport const getReleaseNewIssuesUrl = (\n  orgSlug: string,\n  projectId: string | number | null,\n  version: string\n) => {\n  return {\n    pathname: `/organizations/${orgSlug}/issues/`,\n    query: {\n      project: projectId,\n      // we are resetting time selector because releases' new issues count doesn't take time selector into account\n      statsPeriod: undefined,\n      start: undefined,\n      end: undefined,\n      query: new MutableSearch([`firstRelease:${version}`]).formatString(),\n      sort: IssueSortOptions.FREQ,\n    },\n  };\n};\n\nexport const getReleaseUnhandledIssuesUrl = (\n  orgSlug: string,\n  projectId: string | number | null,\n  version: string,\n  dateTime: DateTimeObject = {}\n) => {\n  return {\n    pathname: `/organizations/${orgSlug}/issues/`,\n    query: {\n      ...dateTime,\n      project: projectId,\n      query: new MutableSearch([\n        `release:${version}`,\n        'error.unhandled:true',\n      ]).formatString(),\n      sort: IssueSortOptions.FREQ,\n    },\n  };\n};\n\nexport const getReleaseHandledIssuesUrl = (\n  orgSlug: string,\n  projectId: string | number | null,\n  version: string,\n  dateTime: DateTimeObject = {}\n) => {\n  return {\n    pathname: `/organizations/${orgSlug}/issues/`,\n    query: {\n      ...dateTime,\n      project: projectId,\n      query: new MutableSearch([\n        `release:${version}`,\n        'error.handled:true',\n      ]).formatString(),\n      sort: IssueSortOptions.FREQ,\n    },\n  };\n};\n\nexport const isReleaseArchived = (release: Release) =>\n  release.status === ReleaseStatus.Archived;\n\nexport function releaseDisplayLabel(displayOption: DisplayOption, count?: number | null) {\n  if (displayOption === DisplayOption.USERS) {\n    return tn('user', 'users', count);\n  }\n\n  return tn('session', 'sessions', count);\n}\n\nexport type ReleaseBounds = {releaseStart?: string | null; releaseEnd?: string | null};\n\nexport function getReleaseBounds(release?: Release): ReleaseBounds {\n  const {lastEvent, currentProjectMeta, dateCreated} = release || {};\n  const {sessionsUpperBound} = currentProjectMeta || {};\n\n  const releaseStart = moment(dateCreated).startOf('minute').utc().format();\n  const releaseEnd = moment(\n    (moment(sessionsUpperBound).isAfter(lastEvent) ? sessionsUpperBound : lastEvent) ??\n      undefined\n  )\n    .endOf('minute')\n    .utc()\n    .format();\n\n  if (moment(releaseStart).isSame(releaseEnd, 'minute')) {\n    return {\n      releaseStart,\n      releaseEnd: moment(releaseEnd).add(1, 'minutes').utc().format(),\n    };\n  }\n\n  return {\n    releaseStart,\n    releaseEnd,\n  };\n}\n\ntype GetReleaseParams = {\n  location: Location;\n  releaseBounds: ReleaseBounds;\n};\n\nexport function getReleaseParams({location, releaseBounds}: GetReleaseParams) {\n  const params = getParams(\n    pick(location.query, [\n      ...Object.values(URL_PARAM),\n      ...Object.values(PAGE_URL_PARAM),\n      'cursor',\n    ]),\n    {\n      allowAbsolutePageDatetime: true,\n      allowEmptyPeriod: true,\n    }\n  );\n  if (\n    !Object.keys(params).some(param =>\n      [URL_PARAM.START, URL_PARAM.END, URL_PARAM.UTC, URL_PARAM.PERIOD].includes(param)\n    )\n  ) {\n    params[URL_PARAM.START] = releaseBounds.releaseStart;\n    params[URL_PARAM.END] = releaseBounds.releaseEnd;\n  }\n\n  return params;\n}\n","import {PlatformKey} from 'app/data/platformCategories';\nimport {t} from 'app/locale';\n\nexport enum SessionTerm {\n  CRASHES = 'crashes',\n  CRASHED = 'crashed',\n  ABNORMAL = 'abnormal',\n  CRASH_FREE = 'crashFree',\n  CRASH_FREE_USERS = 'crash-free-users',\n  CRASH_FREE_SESSIONS = 'crash-free-sessions',\n  HEALTHY = 'healthy',\n  ERRORED = 'errored',\n  UNHANDLED = 'unhandled',\n  STABILITY = 'stability',\n  ADOPTION = 'adoption',\n}\n\nexport const sessionTerm = {\n  [SessionTerm.CRASHES]: t('Crashes'),\n  [SessionTerm.CRASHED]: t('Crashed'),\n  [SessionTerm.ABNORMAL]: t('Abnormal'),\n  [SessionTerm.CRASH_FREE_USERS]: t('Crash Free Users'),\n  [SessionTerm.CRASH_FREE_SESSIONS]: t('Crash Free Sessions'),\n  [SessionTerm.HEALTHY]: t('Healthy'),\n  [SessionTerm.ERRORED]: t('Errored'),\n  [SessionTerm.UNHANDLED]: t('Unhandled'),\n  [SessionTerm.ADOPTION]: t('Adoption'),\n  duration: t('Session Duration'),\n  otherCrashed: t('Other Crashed'),\n  otherAbnormal: t('Other Abnormal'),\n  otherErrored: t('Other Errored'),\n  otherHealthy: t('Other Healthy'),\n  otherCrashFreeUsers: t('Other Crash Free Users'),\n  otherCrashFreeSessions: t('Other Crash Free Sessions'),\n  otherReleases: t('Other Releases'),\n};\n\n// This should never be used directly (except in tests)\nexport const commonTermsDescription = {\n  [SessionTerm.CRASHES]: t('Number of sessions with a crashed state'),\n  [SessionTerm.CRASH_FREE]: t(\n    'Percentage of sessions/users who did not experience a crash.'\n  ),\n  [SessionTerm.CRASH_FREE_USERS]: t(\n    'Percentage of unique users with non-crashed sessions'\n  ),\n  [SessionTerm.CRASH_FREE_SESSIONS]: t('Percentage of non-crashed sessions'),\n  [SessionTerm.STABILITY]: t('The percentage of crash free sessions.'),\n  [SessionTerm.ADOPTION]: t(\n    'Adoption compares the sessions or users of a release with the total sessions or users for this project in the last 24 hours.'\n  ),\n};\n\n// This should never be used directly (except in tests)\nexport const mobileTermsDescription = {\n  [SessionTerm.CRASHED]: t(\n    'The process was terminated due to an unhandled exception or a request to the server that ended with an error'\n  ),\n  [SessionTerm.CRASH_FREE_SESSIONS]: t('Percentage of non-crashed sessions'),\n  [SessionTerm.ABNORMAL]: t(\n    'An unknown session exit. Like due to loss of power or killed by the operating system'\n  ),\n  [SessionTerm.HEALTHY]: t('A session without errors'),\n  [SessionTerm.ERRORED]: t('A session with errors'),\n  [SessionTerm.UNHANDLED]: t('Not handled by user code'),\n};\n\n// This should never be used directly (except in tests)\nexport const desktopTermDescriptions = {\n  crashed: t('The application crashed with a hard crash (eg. segfault)'),\n  [SessionTerm.ABNORMAL]: t(\n    'The application did not properly end the session, for example, due to force-quit'\n  ),\n  [SessionTerm.HEALTHY]: t(\n    'The application exited normally and did not observe any errors'\n  ),\n  [SessionTerm.ERRORED]: t(\n    'The application exited normally but observed error events while running'\n  ),\n  [SessionTerm.UNHANDLED]: t('The application crashed with a hard crash'),\n};\n\nfunction getTermDescriptions(platform: PlatformKey | null) {\n  const technology =\n    platform === 'react-native' ||\n    platform === 'java-spring' ||\n    platform === 'apple-ios' ||\n    platform === 'dotnet-aspnetcore'\n      ? platform\n      : platform?.split('-')[0];\n\n  switch (technology) {\n    case 'dotnet':\n    case 'java':\n      return {\n        ...commonTermsDescription,\n        ...mobileTermsDescription,\n      };\n    case 'java-spring':\n    case 'dotnet-aspnetcore':\n      return {\n        ...commonTermsDescription,\n        ...mobileTermsDescription,\n        [SessionTerm.CRASHES]: t(\n          'A request that resulted in an unhandled exception and hence a Server Error response'\n        ),\n      };\n    case 'android':\n    case 'cordova':\n    case 'react-native':\n    case 'flutter':\n      return {\n        ...commonTermsDescription,\n        ...mobileTermsDescription,\n        [SessionTerm.CRASHED]: t(\n          'An unhandled exception that resulted in the application crashing'\n        ),\n      };\n\n    case 'apple': {\n      return {\n        ...commonTermsDescription,\n        ...mobileTermsDescription,\n        [SessionTerm.CRASHED]: t('An error that resulted in the application crashing'),\n      };\n    }\n    case 'node':\n    case 'javascript':\n      return {\n        ...commonTermsDescription,\n        [SessionTerm.CRASHED]: t(\n          'During the session an unhandled global error/promise rejection occurred.'\n        ),\n        [SessionTerm.ABNORMAL]: t('Non applicable for Javascript.'),\n        [SessionTerm.HEALTHY]: t('No errors were captured during session life-time.'),\n        [SessionTerm.ERRORED]: t(\n          'During the session at least one handled error occurred.'\n        ),\n        [SessionTerm.UNHANDLED]:\n          \"An error was captured by the global 'onerror' or 'onunhandledrejection' handler.\",\n      };\n    case 'apple-ios':\n    case 'minidump':\n    case 'native':\n      return {\n        ...commonTermsDescription,\n        ...desktopTermDescriptions,\n      };\n    case 'rust':\n      return {\n        ...commonTermsDescription,\n        ...desktopTermDescriptions,\n        [SessionTerm.CRASHED]: t('The application had an unrecoverable error (a panic)'),\n      };\n    default:\n      return {\n        ...commonTermsDescription,\n        [SessionTerm.CRASHED]: t('Number of users who experienced an unhandled error'),\n        [SessionTerm.ABNORMAL]: t('An unknown session exit'),\n        [SessionTerm.HEALTHY]: mobileTermsDescription.healthy,\n        [SessionTerm.ERRORED]: mobileTermsDescription.errored,\n        [SessionTerm.UNHANDLED]: mobileTermsDescription.unhandled,\n      };\n  }\n}\n\nexport function getSessionTermDescription(\n  term: SessionTerm,\n  platform: PlatformKey | null\n) {\n  return getTermDescriptions(platform)[term];\n}\n"],"names":["getCount","groups","field","reduce","acc","group","totals","getCrashFreeRate","crashedRate","getSessionStatusRate","SessionStatus","defined","getCrashFreePercent","getSeriesAverage","totalCount","dataPoints","filter","length","status","crashedCount","by","percent","getCrashFreeRateSeries","intervals","compact","map","interval","i","intervalTotalSessions","series","intervalCrashedSessions","find","crashedSessionsPercent","name","value","getSessionStatusRateSeries","intervalStatusSessions","statusSessionsPercent","getSessionStatusPercent","getSessionP50Series","valueFormatter","meanValue","mean","v","getAdoptionSeries","releaseGroups","allGroups","intervalReleaseSessions","intervalAdoption","Math","round","getCountSeries","index","initSessionsChart","theme","colors","charts","getColorPalette","seriesName","sessionTerm","data","color","green300","areaStyle","opacity","lineStyle","width","red300","getSessionsInterval","datetimeObj","highFidelity","diffInMinutes","getDiffInMinutes","moment","start","isSameOrBefore","subtract","TWO_WEEKS","ONE_WEEK","filterSessionsInTimeWindow","sessions","end","filteredIndexes","isBetween","undefined","push","Object","keys","forEach","includes","startsWith","query","SortOption","DisplayOption","StatusOption","CRASH_FREE_DECIMAL_THRESHOLD","roundDuration","seconds","decimalThreshold","decimalPlaces","roundedValue","floor","pow","displayCrashFreePercent","isNaN","rounded","toLocaleString","absolute","abs","displaySessionStatusPercent","getReleaseNewIssuesUrl","orgSlug","projectId","version","pathname","project","statsPeriod","MutableSearch","formatString","sort","IssueSortOptions","getReleaseUnhandledIssuesUrl","dateTime","getReleaseHandledIssuesUrl","isReleaseArchived","release","ReleaseStatus","releaseDisplayLabel","displayOption","count","tn","getReleaseBounds","lastEvent","currentProjectMeta","dateCreated","sessionsUpperBound","releaseStart","startOf","utc","format","releaseEnd","isAfter","endOf","isSame","add","getReleaseParams","location","releaseBounds","params","getParams","pick","values","URL_PARAM","PAGE_URL_PARAM","allowAbsolutePageDatetime","allowEmptyPeriod","some","param","SessionTerm","CRASHES","t","CRASHED","ABNORMAL","CRASH_FREE_USERS","CRASH_FREE_SESSIONS","HEALTHY","ERRORED","UNHANDLED","ADOPTION","duration","otherCrashed","otherAbnormal","otherErrored","otherHealthy","otherCrashFreeUsers","otherCrashFreeSessions","otherReleases","commonTermsDescription","CRASH_FREE","STABILITY","mobileTermsDescription","desktopTermDescriptions","crashed","getSessionTermDescription","term","platform","split","healthy","errored","unhandled","getTermDescriptions"],"sourceRoot":""}