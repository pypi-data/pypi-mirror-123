(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dashboardsV2_widget_index_tsx-node_modules_lodash_mean_js"],{"./app/components/pickProjectToContinue.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("./app/actionCreators/modal.tsx")),o=n("./app/components/contextPickerModal.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s({noProjectRedirectPath:e,nextPath:t,router:n,projects:i}){const s=t.query;let d=!1,c="".concat(t.pathname,"?project=");if(s){const e=[...Object.entries(s).filter((([e,t])=>"project"!==e)).map((([e,t])=>"".concat(e,"=").concat(t))),"project="].join("&");c="".concat(t.pathname,"?").concat(e)}return 1===i.length?(n.replace(c+i[0].id),null):((0,r.openModal)((e=>(0,a.tZ)(o.Z,{...e,needOrg:!1,needProject:!0,nextPath:"".concat(c,":project"),onFinish:e=>{d=!0,n.replace(e)},projectSlugs:i.map((e=>e.slug))})),{onClose(){d||n.push(e)}}),(0,a.tZ)(l,{}))}s.displayName="PickProjectToContinue";const l=(0,i.Z)("div",{target:"e1sj8doz0"})({name:"4wiox3",styles:"height:100vh;width:100%"}),d=s},"./app/views/asyncView.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>s}),n("../node_modules/react/index.js");var i=n("../node_modules/react-document-title/index.js"),r=n.n(i),o=n("./app/components/asyncComponent.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class s extends o.Z{getTitle(){return""}render(){const e=this.getTitle();return(0,a.tZ)(r(),{title:"".concat(e?"".concat(e," - "):"","Sentry"),children:this.renderComponent()})}}s.displayName="AsyncView"},"./app/views/dashboardsV2/widget/index.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>It});var i=n("../node_modules/react/index.js"),r=n("./app/components/acl/feature.tsx"),o=n("./app/components/alert.tsx"),a=n("./app/locale.tsx"),s=n("./app/styles/organization.tsx"),l=n("./app/utils/withOrganization.tsx"),d=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("./app/icons/index.tsx")),c=n("./app/utils.tsx"),p=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),u=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),g=n("../node_modules/lodash/cloneDeep.js"),h=n.n(g),m=n("../node_modules/lodash/pick.js"),y=n.n(m),Z=n("../node_modules/lodash/set.js"),v=n.n(Z),f=n("./app/actionCreators/dashboards.tsx"),x=n("./app/actionCreators/indicator.tsx"),b=n("./app/components/dashboards/widgetQueryFields.tsx"),j=n("./app/components/forms/selectControl.tsx"),w=n("./app/components/layouts/thirds.tsx"),C=n("./app/components/panels/index.tsx"),S=n("./app/styles/space.tsx"),T=n("./app/utils/discover/fields.tsx"),k=n("./app/utils/measurements/measurements.tsx"),q=n("./app/utils/withGlobalSelection.tsx"),B=n("./app/utils/withTags.tsx"),E=n("./app/views/asyncView.tsx"),z=n("./app/views/dashboardsV2/widgetCard.tsx"),A=n("./app/views/eventsV2/utils.tsx"),F=n("./app/views/dashboardsV2/types.tsx"),P=(n("../node_modules/core-js/modules/es.symbol.description.js"),n("./app/components/list/listItem.tsx")),_=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function M({title:e,description:t,children:n}){return(0,_.BX)(Q,{children:[(0,_.BX)(N,{children:[(0,_.tZ)(O,{children:e}),(0,_.tZ)(D,{children:t})]}),(0,_.tZ)(L,{children:n})]})}M.displayName="BuildStep";const R=M,Q=(0,u.Z)(P.Z,{target:"e19orf1l4"})("display:grid;grid-gap:",(0,S.Z)(2),";"),O=(0,u.Z)("h4",{target:"e19orf1l3"})({name:"12b6itj",styles:"font-weight:400;margin-bottom:0"}),D=(0,u.Z)("div",{target:"e19orf1l2"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";"),N=(0,u.Z)("div",{target:"e19orf1l1"})("display:grid;grid-gap:",(0,S.Z)(.5),";"),L=(0,u.Z)("div",{target:"e19orf1l0"})({name:"1ut2m0q",styles:"display:grid;grid-template-columns:1fr max-content"});var V=n("./app/components/list/index.tsx");function I({children:e}){return(0,_.tZ)(W,{symbol:"colored-numeric",children:e})}I.displayName="BuildSteps";const X=I,W=(0,u.Z)(V.Z,{target:"e1ax4ly70"})("display:grid;grid-gap:",(0,S.Z)(4),";max-width:100%;@media (min-width: ",(e=>e.theme.breakpoints[4]),"){max-width:50%;}");var U=n("./app/views/settings/components/forms/radioField.tsx"),G=n("./app/views/dashboardsV2/widget/utils.tsx");const H=[[G.qg.EVENTS,(0,a.t)("Events")],[G.qg.METRICS,(0,a.t)("Metrics")]];function J({value:e,onChange:t}){return(0,_.tZ)(R,{title:(0,a.t)("Choose your data set"),description:(0,a.t)("Monitor specific events such as errors and transactions or get metric readings on TBD."),children:(0,_.tZ)(U.Z,{name:"dataSet",onChange:t,value:e,choices:H,inline:!1,orientInline:!0,hideControlState:!0,stacked:!0})})}J.displayName="ChooseDataSetStep";const K=J;var Y=n("./app/components/breadcrumbs.tsx"),$=n("./app/components/button.tsx"),ee=n("./app/components/buttonBar.tsx"),te=n("./app/components/confirm.tsx"),ne=n("./app/components/editableText.tsx");function ie({title:e,orgSlug:t,goBackLocation:n,dashboardTitle:i,onChangeTitle:r,onSave:o,onDelete:s,isEditing:l}){return(0,_.BX)(w.h4,{children:[(0,_.BX)(w.oB,{children:[(0,_.tZ)(Y.Z,{crumbs:[{to:"/organizations/".concat(t,"/dashboards/"),label:(0,a.t)("Dashboards")},{to:n,label:i},{label:(0,a.t)("Widget Builder")}]}),(0,_.tZ)(w.Dx,{children:(0,_.tZ)(ne.Z,{value:e,onChange:r,errorMessage:(0,a.t)("Please set a title for this widget"),successMessage:(0,a.t)("Widget title updated successfully")})})]}),(0,_.tZ)(w.kP,{children:(0,_.BX)(ee.ZP,{gap:1,children:[(0,_.tZ)($.ZP,{title:(0,a.t)("You’re seeing the metrics project because you have the feature flag 'organizations:metrics' enabled. Send us feedback via email."),href:"mailto:metrics-feedback@sentry.io?subject=Metrics Feedback",children:(0,a.t)("Give Feedback")}),(0,_.tZ)($.ZP,{to:n,children:(0,a.t)("Cancel")}),l&&s&&(0,_.tZ)(te.Z,{priority:"danger",message:(0,a.t)("Are you sure you want to delete this widget?"),onConfirm:s,children:(0,_.tZ)($.ZP,{priority:"danger",children:(0,a.t)("Delete")})}),(0,_.tZ)($.ZP,{priority:"primary",onClick:o,disabled:!o,title:o?void 0:(0,a.t)("This feature is not yet available"),children:l?(0,a.t)("Update Widget"):(0,a.t)("Add Widget")})]})})]})}ie.displayName="Header";const re=ie;var oe=n("./app/components/events/searchBar.tsx"),ae=n("./app/views/settings/components/forms/controls/input.tsx"),se=n("./app/views/settings/components/forms/field/index.tsx");function le({queries:e,selectedProjectIds:t,organization:n,displayType:i,onRemoveQuery:r,onAddQuery:o,onChangeQuery:s,errors:l}){function c(t,n){const i=e[t];return function(e){const r={...i,[n]:e};s(t,r)}}const p=[G.FO.TABLE,G.FO.WORLD_MAP,G.FO.BIG_NUMBER].includes(i);return(0,_.BX)("div",{children:[e.map(((i,o)=>{const s=e.length>1,u=!p;return(0,_.tZ)(ue,{inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==l?void 0:l[o].conditions,children:(0,_.BX)(pe,{displayDeleteButton:s,displayLegendAlias:u,children:[(0,_.tZ)(oe.Z,{organization:n,projectIds:t,query:i.conditions,fields:[],onSearch:c(o,"conditions"),onBlur:c(o,"conditions"),useFormWrapper:!1}),u&&(0,_.tZ)(ae.Z,{type:"text",name:"name",required:!0,value:i.name,placeholder:(0,a.t)("Legend Alias"),onChange:e=>c(o,"name")(e.target.value)}),s&&(0,_.tZ)($.ZP,{size:"zero",borderless:!0,onClick:e=>{e.preventDefault(),r(o)},icon:(0,_.tZ)(d.Fz,{}),title:(0,a.t)("Remove query"),label:(0,a.t)("Remove query")})]})},o)})),function(){const t=[G.FO.LINE,G.FO.AREA,G.FO.STACKED_AREA,G.FO.BAR].includes(i),n=e.length<3;return t&&n}()&&(0,_.tZ)($.ZP,{size:"small",icon:(0,_.tZ)(d.N_,{isCircled:!0}),onClick:e=>{e.preventDefault(),o()},children:(0,a.t)("Add Query")})]})}le.displayName="Queries";const de=le,ce=e=>e.displayDeleteButton||e.displayLegendAlias?e.displayDeleteButton?e.displayLegendAlias?"1fr 33% max-content":"1fr max-content":"1fr 33%":"1fr",pe=(0,u.Z)("div",{target:"eevqrq41"})("display:grid;grid-template-columns:",ce,";grid-gap:",(0,S.Z)(1),";align-items:center;"),ue=(0,u.Z)(se.Z,{target:"eevqrq40"})({name:"jjyo93",styles:"padding-right:0"});var ge=n("./app/views/dashboardsV2/widget/eventWidget/utils.tsx");const he={name:"",fields:["count()"],conditions:"",orderby:""};class me extends E.Z{constructor(...e){super(...e),(0,p.Z)(this,"handleFieldChange",((e,t)=>{this.setState((n=>{const i=h()(n);if("displayType"===e){if(v()(i,"queries",(0,ge.Z)(t,n.queries)),n.title===(0,a.t)("Custom %s Widget",n.displayType)||n.title===(0,a.t)("Custom %s Widget",F.FO.AREA))return{...i,title:(0,a.t)("Custom %s Widget",G.hV[t]),widgetErrors:void 0};v()(i,e,t)}return{...i,widgetErrors:void 0}}))})),(0,p.Z)(this,"handleRemoveQuery",(e=>{this.setState((t=>{const n=h()(t);return n.queries.splice(e,1),{...n,widgetErrors:void 0}}))})),(0,p.Z)(this,"handleAddQuery",(()=>{this.setState((e=>{const t=h()(e);return t.queries.push(h()(he)),t}))})),(0,p.Z)(this,"handleChangeQuery",((e,t)=>{this.setState((n=>{const i=h()(n);return v()(i,"queries.".concat(e),t),{...i,widgetErrors:void 0}}))})),(0,p.Z)(this,"handleSave",(async e=>{e.preventDefault(),this.setState({loading:!0});const{organization:t,onAdd:n,isEditing:i,onUpdate:r,widget:o}=this.props;try{const e=y()(this.state,["title","displayType","interval","queries"]);if(await(0,f.QL)(this.api,t.slug,e),i)return r({id:o.id,...e}),void(0,x.S9)((0,a.t)("Updated widget"));n(e),(0,x.S9)((0,a.t)("Added widget"))}catch(e){var s;const t=(0,ge.w)(null!==(s=null==e?void 0:e.responseJSON)&&void 0!==s?s:{},{});this.setState({widgetErrors:t})}finally{this.setState({loading:!1})}}))}getDefaultState(){const{widget:e}=this.props;return e?{...super.getDefaultState(),title:e.title,displayType:e.displayType,interval:e.interval,queries:(0,ge.Z)(e.displayType,e.queries),widgetErrors:void 0}:{...super.getDefaultState(),title:(0,a.t)("Custom %s Widget",G.hV[F.FO.AREA]),displayType:F.FO.AREA,interval:"5m",queries:[{...he}]}}getFirstQueryError(e){var t;const{widgetErrors:n}=this.state;if(!n)return;const[i,r]=null!==(t=Object.entries(n).find(((t,n)=>String(t)===e)))&&void 0!==t?t:[];return(0,c.ri)(i)&&(0,c.ri)(r)?{[i]:r}:void 0}renderBody(){const{organization:e,onChangeDataSet:t,selection:n,tags:i,isEditing:r,goBackLocation:o,dashboardTitle:s,onDelete:l}=this.props,{title:d,displayType:c,queries:p,interval:u,widgetErrors:g}=this.state,m=e.slug,y=p[0].fields.map((e=>(0,T.HM)({field:e})));return(0,_.BX)(Ze,{children:[(0,_.tZ)(re,{dashboardTitle:s,orgSlug:m,title:d,isEditing:r,onChangeTitle:e=>this.handleFieldChange("title",e),onSave:this.handleSave,onDelete:l,goBackLocation:o}),(0,_.tZ)(w.uT,{children:(0,_.BX)(X,{children:[(0,_.tZ)(R,{title:(0,a.t)("Choose your visualization"),description:(0,a.t)("This is a preview of how your widget will appear in the dashboard."),children:(0,_.BX)(ve,{children:[(0,_.tZ)(j.Z,{name:"displayType",options:Object.keys(G.hV).map((e=>({label:G.hV[e],value:e}))),value:c,onChange:e=>{this.handleFieldChange("displayType",e.value)},error:null==g?void 0:g.displayType}),(0,_.tZ)(z.Z,{api:this.api,organization:e,selection:n,widget:{title:d,queries:p,displayType:c,interval:u},isEditing:!1,onDelete:()=>{},onEdit:()=>{},renderErrorMessage:e=>"string"==typeof e&&(0,_.tZ)(C.aU,{type:"error",children:e}),isSorting:!1,currentWidgetDragging:!1})]})}),(0,_.tZ)(K,{value:G.qg.EVENTS,onChange:t}),(0,_.tZ)(R,{title:(0,a.t)("Begin your search"),description:(0,a.t)("Add another query to compare projects, tags, etc."),children:(0,_.tZ)(de,{queries:p,selectedProjectIds:n.projects,organization:e,displayType:c,onRemoveQuery:this.handleRemoveQuery,onAddQuery:this.handleAddQuery,onChangeQuery:this.handleChangeQuery,errors:null==g?void 0:g.queries})}),(0,_.tZ)(k.Z,{organization:e,children:({measurements:t})=>{const n=(o=Object.values(t).map((({key:e})=>e)),(0,A.R0)({organization:e,tagKeys:Object.values(i).map((({key:e})=>e)),measurementKeys:o})),r=(0,_.tZ)(b.Z,{style:{padding:0},errors:this.getFirstQueryError("fields"),displayType:c,fieldOptions:n,fields:y,organization:e,onChange:e=>{const t=e.map((e=>(0,T.sN)(e)));p.forEach(((e,n)=>{const i=h()(e);i.fields=t,this.handleChangeQuery(n,i)}))}});var o;return(0,_.tZ)(R,{title:c===F.FO.TABLE?(0,a.t)("Choose your columns"):(0,a.t)("Choose your y-axis"),description:(0,a.t)("We’ll use this to determine what gets graphed in the y-axis and any additional overlays."),children:r})}})]})})]})}}const ye=(0,l.Z)((0,q.Z)((0,B.Z)(me))),Ze=(0,u.Z)(s.JH,{target:"e1eprnb31"})({name:"1hcx8jb",styles:"padding:0"}),ve=(0,u.Z)("div",{target:"e1eprnb30"})("display:grid;grid-gap:",(0,S.Z)(1.5),";");var fe=n("../node_modules/react-select/dist/chunk-80640036.browser.esm.js"),xe=n("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),be=n("./app/components/idBadge/projectBadge.tsx"),je=n("./app/components/pickProjectToContinue.tsx"),we=n("./app/utils/withProjects.tsx"),Ce=n("./app/views/settings/components/forms/selectField.tsx"),Se=n("./app/components/charts/styles.tsx"),Te=n("./app/components/errorBoundary.tsx"),ke=n("./app/components/placeholder.tsx"),qe=n("./app/styles/overflowEllipsis.tsx"),Be=n("./app/components/charts/areaChart.tsx"),Ee=n("./app/components/charts/barChart.tsx"),ze=n("./app/components/charts/chartZoom.tsx"),Ae=n("./app/components/charts/errorPanel.tsx"),Fe=n("./app/components/charts/lineChart.tsx"),Pe=n("./app/components/charts/transitionChart.tsx"),_e=n("./app/components/charts/transparentLoadingMask.tsx"),Me=n("./app/components/charts/utils.tsx"),Re=n("./app/components/loadingIndicator.tsx"),Qe=n("./app/utils/getDynamicText.tsx"),Oe=n("./app/views/releases/utils/sessionTerm.tsx");function De({series:e,displayType:t,location:n,errored:i,isLoading:r,selection:o,router:a,platform:s}){const{datetime:l}=o,{utc:c,period:p,start:u,end:g}=l,h=(0,xe.u)(),m=e.filter((({seriesName:e})=>e!==Oe.U1.abnormal&&e!==Oe.U1.otherAbnormal||!s||!["javascript","node"].includes(s))),y=e?h.charts.getColorPalette(e.length-2):[],Z={series:m?m.map(((e,t)=>({...e,color:y[t]}))):[],legend:{right:10,top:0,selected:(0,Me.RI)(n)},grid:{left:"0px",right:"10px",top:"30px",bottom:"0px"}};function v(e){switch(t){case G.FO.BAR:return(0,_.tZ)(Ee.Z,{...e,...Z});case G.FO.AREA:return(0,_.tZ)(Be.Z,{...e,stacked:!0,...Z});case G.FO.LINE:default:return(0,_.tZ)(Fe.Z,{...e,...Z})}}return(0,_.tZ)(ze.Z,{router:a,period:p,utc:c,start:u,end:g,children:e=>i?(0,_.tZ)(Ae.Z,{children:(0,_.tZ)(d.FC,{color:"gray300",size:"lg"})}):(0,_.BX)(Pe.Z,{loading:r,reloading:r,children:[(0,_.tZ)(Le,{loading:r}),(0,Qe.Z)({value:v(e),fixed:(0,_.tZ)(ke.Z,{height:"200px",testId:"skeleton-ui"})})]})})}De.displayName="Chart";const Ne=De,Le=({loading:e})=>e?(0,_.tZ)(Ve,{visible:e,children:(0,_.tZ)(Re.Z,{mini:!0})}):null;Le.displayName="LoadingScreen";const Ve=(0,u.Z)((e=>(0,_.tZ)(_e.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e14w9uws0"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"});var Ie=n("./app/components/organizations/globalSelectionHeader/getParams.tsx"),Xe=n("./app/constants/globalSelectionHeader.tsx"),We=n("./app/utils/sessions.tsx"),Ue=n("./app/utils/tokenizeSearch.tsx"),Ge=n("./app/views/releases/utils/index.tsx");function He(e,t){return e.map((e=>t[e])).join("_")}const Je=function({api:e,organization:t,projectSlug:n,groupings:r,environments:o,datetime:s,location:l,children:d,searchQuery:c}){const[p,u]=(0,i.useState)(!1),[g,h]=(0,i.useState)(!1),[m,Z]=(0,i.useState)([]),v=r.filter((({aggregation:e,metricMeta:t})=>!(null==t||!t.name||!e)));return(0,i.useEffect)((()=>{!function(){if(!v.length)return;h(!1),u(!0);const i=(0,Ie.Q)(y()(l.query,Object.values(Xe.nF).filter((e=>e!==Xe.nF.PROJECT)))),r=v.map((({metricMeta:r,aggregation:o,groupBy:a})=>{const l={field:"".concat(o,"(").concat(r.name,")"),interval:(0,We.Xz)(s),...i};if(c){const e=c.split(" ").filter((e=>!!e)).map((e=>{const[t,n]=e.split(":");return t&&n?"".concat(t,':"').concat(n,'"'):""})).filter((e=>!!e));e.length&&(l.query=new Ue.MY(e).formatString())}const d="/projects/".concat(t.slug,"/").concat(n,"/metrics/data/");if(null!=a&&a.length){const t=[...a].join("&groupBy=");return e.requestPromise("".concat(d,"?groupBy=").concat(t),{query:l})}return e.requestPromise(d,{query:l})}));Promise.all(r).then((e=>{!function(e){if(!e.length)return void u(!1);const t=e.map(((e,t)=>{const{aggregation:n,legend:i,metricMeta:r}=v[t],o=function({response:e,field:t,chartData:n,valueFormatter:i}){return e.intervals.forEach(((r,o)=>{for(const a in e.groups){const s=e.groups[a],l=Object.keys(s.by),d=s.series[t][o];if(!l.length)return void n[0].data.push({name:r,value:"function"==typeof i?i(d):d});const c=He(l,s.by);n[c].data.push({name:r,value:"function"==typeof i?i(d):d})}})),n}({response:e,field:"".concat(n,"(").concat(r.name,")"),chartData:function({response:e,sessionResponseIndex:t,legend:n}){return e.groups.reduce(((e,i,r)=>{const o=Object.keys(i.by);if(!o.length)return e[r]={seriesName:null!=n?n:"Query ".concat(t),data:[]},e;const a=He(o,i.by);return e[a]={seriesName:n?"".concat(n,"_").concat(a):a,data:[]},e}),{})}({response:e,sessionResponseIndex:t+1,legend:i}),valueFormatter:"session.duration"===r.name?e=>(0,Ge.G5)(e?e/1e3:0):void 0});return[...Object.values(o)]})).reduce(((e,t)=>e.concat(t)),[]);Z(t),u(!1)}(e)})).catch((e=>{var t,n;(0,x.Iw)(null!==(t=null===(n=e.responseJSON)||void 0===n?void 0:n.detail)&&void 0!==t?t:(0,a.t)("Error loading chart data")),h(!0)}))}()}),[n,o,s,r,c]),d({isLoading:p,errored:g,series:m})};function Ke({widget:e,api:t,location:n,router:i,organization:r,project:o,selection:s}){const{groupings:l,searchQuery:d,title:c,displayType:p}=e;return(0,_.tZ)(Te.Z,{customComponent:(0,_.tZ)(et,{children:(0,a.t)("Error loading widget data")}),children:(0,_.BX)($e,{children:[(0,_.tZ)(tt,{children:c}),(0,_.tZ)(Je,{api:t,location:n,organization:r,projectSlug:o.slug,groupings:l,searchQuery:d,environments:s.environments,datetime:s.datetime,children:({isLoading:e,errored:t,series:r})=>(0,_.tZ)(Ne,{displayType:p,series:r,isLoading:e,errored:t,location:n,platform:o.platform,selection:s,router:i})})]})})}Ke.displayName="Card";const Ye=Ke,$e=(0,u.Z)(C.s_,{target:"eh9emak2"})("margin:0;height:100%;min-height:96px;padding:",(0,S.Z)(2)," ",(0,S.Z)(3),";"),et=(0,u.Z)(ke.Z,{target:"eh9emak1"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,S.Z)(2),";"),tt=(0,u.Z)(Se.Gh,{target:"eh9emak0"})(qe.Z,";");var nt=n("./app/components/checkboxFancy/checkboxFancy.tsx"),it=n("./app/components/dropdownAutoComplete/index.tsx"),rt=n("./app/components/highlight.tsx"),ot=n("./app/components/textOverflow.tsx"),at=n("./app/styles/input.tsx");function st({metricTags:e,groupBy:t=[],onChange:n}){const r=!!t.length;function o(e){e.stopPropagation(),n([])}return(0,_.tZ)(it.Z,{searchPlaceholder:(0,a.t)("Search tag"),items:e.map((e=>({value:e,searchKey:e,label:({inputValue:i})=>(0,_.BX)(ct,{onClick:()=>function(e){if(t.includes(e)){const i=t.filter((t=>t!==e));n(i)}else n([...new Set([...t,e])])}(e),children:[(0,_.tZ)("div",{children:(0,_.tZ)(rt.Z,{text:i,children:e})}),(0,_.tZ)(nt.Z,{isChecked:t.includes(e)})]})}))),style:{width:"100%",borderRadius:0},maxHeight:110,children:({isOpen:e,getActorProps:n})=>(0,_.BX)(dt,{...n(),hasSelected:r,isOpen:e,children:[r?(0,_.BX)(i.Fragment,{children:[(0,_.tZ)(ht,{children:t.map((e=>e)).join(",")}),(0,_.tZ)(ut,{color:r?"textColor":"gray300",onClick:o})]}):(0,_.tZ)(gt,{children:(0,a.t)("Group by")}),(0,_.tZ)(pt,{children:(0,_.tZ)(d.g6,{direction:e?"up":"down",size:"sm",color:e?"textColor":"gray300"})})]})})}st.displayName="GroupByField";const lt=st,dt=(0,u.Z)("div",{target:"e1dtpikc5"})((e=>(0,at.T)(e)),";padding:0 10px;min-width:250px;display:grid;grid-template-columns:",(e=>e.hasSelected?"1fr max-content max-content":"1fr  max-content"),";resize:none;overflow:hidden;align-items:center;",(e=>e.isOpen&&"\n      border-bottom-left-radius: 0;\n      border-bottom-right-radius: 0;\n    "),";"),ct=(0,u.Z)("div",{target:"e1dtpikc4"})("display:grid;grid-template-columns:1fr max-content;grid-gap:",(0,S.Z)(1.5),";word-break:break-all;"),pt=(0,u.Z)("div",{target:"e1dtpikc3"})("width:14px;height:14px;display:inline-flex;align-items:center;justify-content:center;margin-left:",(0,S.Z)(1),";"),ut=(0,u.Z)(d.bM,{target:"e1dtpikc2"})("height:100%;width:10px;padding:",(0,S.Z)(1)," 0;stroke-width:1.5;margin-left:",(0,S.Z)(1),";box-sizing:content-box;"),gt=(0,u.Z)("div",{target:"e1dtpikc1"})("flex:1;color:",(e=>e.theme.gray200),";padding:0 ",(0,S.Z)(.25),";"),ht=(0,u.Z)(ot.Z,{target:"e1dtpikc0"})({name:"82a6rk",styles:"flex:1"});var mt=n("./app/components/tooltip.tsx");function yt({metricMetas:e,metricMeta:t,aggregation:n,onChange:i}){var r,o;const s=null!==(r=null==t?void 0:t.operations)&&void 0!==r?r:[];return(0,_.BX)(ft,{children:[(0,_.tZ)(vt,{name:"metric",options:e.map((e=>({value:e.name,label:e.name}))),placeholder:(0,a.t)("Select metric"),onChange:t=>{const n=e.find((e=>e.name===t));i("metricMeta",n)},value:null!==(o=null==t?void 0:t.name)&&void 0!==o?o:"",components:{Option:({label:e,...t})=>{const{selectProps:n}=t,{inputValue:i}=n;return(0,_.tZ)(fe.y.Option,{label:e,...t,children:(0,_.tZ)(rt.Z,{text:null!=i?i:"",children:e})})}},styles:{control:e=>({...e,borderTopRightRadius:0,borderBottomRightRadius:0,borderRight:"none",boxShadow:"none"})},inline:!1,flexibleControlStateSize:!0,stacked:!0,allowClear:!0}),(0,_.tZ)(mt.Z,{disabled:!!s.length,title:(0,a.t)("Please select a metric to enable this field"),children:(0,_.tZ)(j.Z,{name:"aggregation",placeholder:(0,a.t)("Aggr"),disabled:!s.length,options:s.map((e=>({label:"count_unique"===e?"unique":e,value:e}))),value:null!=n?n:"",onChange:({value:e})=>i("aggregation",e),styles:{control:e=>({...e,borderTopLeftRadius:0,borderBottomLeftRadius:0,boxShadow:"none"})}})})]})}yt.displayName="MetricSelectField";const Zt=yt,vt=(0,u.Z)(Ce.Z,{target:"e1841qdy1"})({name:"1whsp4d",styles:"padding-right:0;padding-bottom:0"}),ft=(0,u.Z)("div",{target:"e1841qdy0"})({name:"rbxygr",styles:"display:grid;grid-template-columns:1fr 0.5fr"});function xt({metricMetas:e,metricTags:t,queries:n,onRemoveQuery:r,onAddQuery:o,onChangeQuery:s}){function l(e,t){const i=n[e];return function(n){const r={...i,[t]:n};s(e,r)}}return(0,_.BX)(Ct,{children:[n.map(((o,s)=>(0,_.BX)(wt,{displayDeleteButton:n.length>1,children:[(0,_.tZ)(Zt,{metricMetas:e,metricMeta:o.metricMeta,aggregation:o.aggregation,onChange:(e,t)=>l(s,e)(t)}),(0,_.tZ)(lt,{metricTags:t,groupBy:o.groupBy,onChange:e=>l(s,"groupBy")(e)}),(0,_.tZ)(ae.Z,{type:"text",name:"legend",value:o.legend,placeholder:(0,a.t)("Legend Alias"),onChange:e=>l(s,"legend")(e.target.value),required:!0}),n.length>1&&(0,_.BX)(i.Fragment,{children:[(0,_.tZ)(St,{children:(0,_.tZ)($.ZP,{onClick:()=>{r(s)},size:"small",children:(0,a.t)("Delete Query")})}),(0,_.tZ)(jt,{onClick:()=>{r(s)},children:(0,_.tZ)(d.Fz,{"aria-label":(0,a.t)("Delete Query")})})]})]},s))),(0,_.tZ)("div",{children:(0,_.tZ)($.ZP,{size:"small",icon:(0,_.tZ)(d.N_,{isCircled:!0}),onClick:o,children:(0,a.t)("Add query")})})]})}xt.displayName="Queries";const bt=xt,jt=(0,u.Z)("div",{target:"e1ba9e483"})("height:40px;cursor:pointer;display:none;@media (min-width: ",(e=>e.theme.breakpoints[3]),"){display:flex;align-items:center;}"),wt=(0,u.Z)("div",{target:"e1ba9e482"})("display:grid;grid-gap:",(0,S.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[3]),"){grid-template-columns:",(e=>e.displayDeleteButton?"1.3fr 1fr 0.5fr max-content":"1.3fr 1fr 0.5fr"),";grid-gap:",(0,S.Z)(1),";align-items:center;}"),Ct=(0,u.Z)("div",{target:"e1ba9e481"})("display:grid;grid-gap:",(0,S.Z)(2),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){",wt,"{:not(:first-child){border-top:1px solid ",(e=>e.theme.border),";padding-top:",(0,S.Z)(2),";}}}"),St=(0,u.Z)("div",{target:"e1ba9e480"})("display:flex;justify-content:flex-end;@media (min-width: ",(e=>e.theme.breakpoints[3]),"){display:none;}");var Tt,kt=n("../node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js"),qt=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),Bt=n("../node_modules/lodash/memoize.js"),Et=n.n(Bt),zt=n("./app/components/smartSearchBar/index.tsx"),At=n("./app/constants/index.tsx");const Ft=new RegExp("^".concat(At.c$,"|\\").concat(At.ir),"g");function Pt({api:e,orgSlug:t,projectSlug:n,tags:i,onSearch:r,onBlur:o}){function s(e){return e.replace(Ft,"")}function l(i,r){return(o=i.key,e.requestPromise("/projects/".concat(t,"/").concat(n,"/metrics/tags/").concat(o,"/"),{method:"GET"})).then((e=>e),(()=>{throw new Error("Unable to fetch tag values")}));var o}const d=i.reduce(((e,t)=>(e[t]={key:t,name:t},e)),{});return(0,_.tZ)(qt.ms,{children:({css:e})=>(0,_.tZ)(zt.Z,{placeholder:(0,a.t)("Search for tag"),onGetTagValues:Et()(l,(({key:e},t)=>"".concat(e,"-").concat(t))),supportedTags:d,prepareQuery:s,onSearch:r,onBlur:o,useFormWrapper:!1,excludeEnvironment:!0,dropdownClassName:e(Tt||(Tt=(0,kt.Z)(["\n            max-height: 300px;\n            overflow-y: auto;\n          "])))})})}Pt.displayName="SearchQueryField";const _t=Pt;class Mt extends E.Z{constructor(...e){super(...e),(0,p.Z)(this,"handleFieldChange",((e,t)=>{this.setState((n=>{const i=h()(n);if("displayType"===e){if(n.title===(0,a.t)("Custom %s Widget",n.displayType)||n.title===(0,a.t)("Custom %s Widget",G.FO.AREA))return{...i,title:(0,a.t)("Custom %s Widget",G.hV[t]),widgetErrors:void 0};v()(i,e,t)}return{...i,widgetErrors:void 0}}))})),(0,p.Z)(this,"handleRemoveQuery",(e=>{this.setState((t=>{const n=h()(t);return n.queries.splice(e,1),n}))})),(0,p.Z)(this,"handleAddQuery",(()=>{this.setState((e=>{const t=h()(e);return t.queries.push({}),t}))})),(0,p.Z)(this,"handleChangeQuery",((e,t)=>{var n,i;(null===(n=this.state.queries[e].metricMeta)||void 0===n?void 0:n.name)!==(null===(i=t.metricMeta)||void 0===i?void 0:i.name)&&(t.aggregation=t.metricMeta?t.metricMeta.operations[0]:void 0),this.setState((n=>{const i=h()(n);return v()(i,"queries.".concat(e),t),i}))})),(0,p.Z)(this,"handleProjectChange",(e=>{const{router:t,location:n}=this.props;t.replace({pathname:n.pathname,query:{...n.query,project:e}})}))}getDefaultState(){return{...super.getDefaultState(),title:(0,a.t)("Custom %s Widget",G.hV[G.FO.AREA]),displayType:G.FO.AREA,metricMetas:[],metricTags:[],queries:[{}]}}get project(){const{projects:e,location:t}=this.props,{query:n}=t,{project:i}=n;return e.find((e=>e.id===i))}getEndpoints(){const{organization:e,loadingProjects:t}=this.props;if(this.isProjectMissingInUrl()||t||!this.project)return[];const n=e.slug,i=this.project.slug;return[["metricMetas","/projects/".concat(n,"/").concat(i,"/metrics/meta/")],["metricTags","/projects/".concat(n,"/").concat(i,"/metrics/tags/")]]}componentDidUpdate(e,t){var n,i;e.loadingProjects&&!this.props.loadingProjects&&this.reloadData(),null!==(n=t.metricMetas)&&void 0!==n&&n.length||null===(i=this.state.metricMetas)||void 0===i||!i.length||this.handleChangeQuery(0,{metricMeta:this.state.metricMetas[0]}),super.componentDidUpdate(e,t)}isProjectMissingInUrl(){const e=this.props.location.query.project;return!e||"string"!=typeof e}renderBody(){const{organization:e,router:t,projects:n,onChangeDataSet:i,selection:r,location:o,loadingProjects:s,goBackLocation:l,dashboardTitle:d}=this.props,{title:c,metricTags:p,searchQuery:u,metricMetas:g,queries:h,displayType:m}=this.state,y=e.slug;if(s)return this.renderLoading();const Z=this.project;return this.isProjectMissingInUrl()||!Z?(0,_.tZ)(je.Z,{router:t,projects:n.map((e=>({id:e.id,slug:e.slug}))),nextPath:{pathname:o.pathname,query:o.query},noProjectRedirectPath:l}):p&&g?(0,_.BX)(Qt,{children:[(0,_.tZ)(re,{orgSlug:y,title:c,dashboardTitle:d,goBackLocation:l,onChangeTitle:e=>this.handleFieldChange("title",e)}),(0,_.tZ)(w.uT,{children:(0,_.BX)(X,{children:[(0,_.tZ)(R,{title:(0,a.t)("Choose your visualization"),description:(0,a.t)("This is a preview of how your widget will appear in the dashboard."),children:(0,_.BX)(Dt,{children:[(0,_.tZ)(Ot,{name:"displayType",options:[G.FO.LINE,G.FO.BAR,G.FO.AREA].map((e=>({value:e,label:G.hV[e]}))),value:m,onChange:e=>{this.handleFieldChange("displayType",e)},inline:!1,flexibleControlStateSize:!0,stacked:!0}),(0,_.tZ)(Ye,{router:t,location:o,selection:r,organization:e,api:this.api,project:Z,widget:{title:c,searchQuery:u,displayType:m,groupings:h}})]})}),(0,_.tZ)(K,{value:G.qg.METRICS,onChange:i}),(0,_.tZ)(R,{title:(0,a.t)("Choose your project"),description:(0,a.t)("You’ll need to select a project to set metrics on."),children:(0,_.tZ)(Ot,{name:"project",options:n.map((e=>({value:e,label:e.slug}))),onChange:e=>this.handleProjectChange(e.id),value:Z,components:{Option:({label:e,...t})=>{const{data:n}=t;return(0,_.tZ)(fe.y.Option,{label:e,...t,children:(0,_.tZ)(be.Z,{project:n.value,avatarSize:18,disableLink:!0})})},SingleValue:({data:e,...t})=>(0,_.tZ)(fe.y.SingleValue,{data:e,...t,children:(0,_.tZ)(be.Z,{project:e.value,avatarSize:18,disableLink:!0})})},styles:{control:e=>({...e,boxShadow:"none"})},allowClear:!1,inline:!1,flexibleControlStateSize:!0,stacked:!0})}),(0,_.tZ)(R,{title:(0,a.t)("Begin your search"),description:(0,a.t)("Select a tag to compare releases, session data, etc."),children:(0,_.tZ)(_t,{api:this.api,tags:p,orgSlug:y,projectSlug:Z.slug,query:u,onSearch:e=>this.handleFieldChange("searchQuery",e),onBlur:e=>this.handleFieldChange("searchQuery",e)})}),(0,_.tZ)(R,{title:(0,a.t)("Add queries"),description:(0,a.t)("We’ll use this to determine what gets graphed in the y-axis and any additional overlays."),children:(0,_.tZ)(bt,{metricMetas:g,metricTags:p,queries:h,onAddQuery:this.handleAddQuery,onRemoveQuery:this.handleRemoveQuery,onChangeQuery:this.handleChangeQuery})})]})})]}):null}}const Rt=(0,xe.b)((0,we.Z)((0,q.Z)(Mt))),Qt=(0,u.Z)(s.JH,{target:"e16v4z0k2"})({name:"1hcx8jb",styles:"padding:0"}),Ot=(0,u.Z)(Ce.Z,{target:"e16v4z0k1"})({name:"jjyo93",styles:"padding-right:0"}),Dt=(0,u.Z)("div",{target:"e16v4z0k0"})("display:grid;grid-gap:",(0,S.Z)(1.5),";");function Nt({dashboard:e,onSave:t,widget:n,params:r,location:s,router:l,organization:p}){const[u,g]=(0,i.useState)(G.qg.EVENTS),h=!!n,{widgetId:m,orgId:y,dashboardId:Z}=r,v={pathname:Z?"/organizations/".concat(y,"/dashboard/").concat(Z,"/"):"/organizations/".concat(y,"/dashboards/new/"),query:{...s.query,dataSet:void 0}};function f(e){l.replace({pathname:s.pathname,query:{...s.query,dataSet:e}})}return(0,i.useEffect)((()=>{!function(){const{query:e}=s,t=null==e?void 0:e.dataSet;if(t)if(t===G.qg.EVENTS||t===G.qg.METRICS)if(t!==G.qg.METRICS)u!==G.qg.EVENTS&&g(G.qg.EVENTS);else{if(u===G.qg.METRICS)return;g(G.qg.METRICS)}else g(void 0);else l.replace({pathname:s.pathname,query:{...s.query,dataSet:G.qg.EVENTS}})}()})),u?h&&!(0,c.ri)(m)||h&&(0,c.ri)(m)&&!e.widgets[m]?(0,_.tZ)(o.Z,{type:"error",icon:(0,_.tZ)(d.FC,{}),children:(0,a.t)("Widget not found.")}):u===G.qg.EVENTS?(0,_.tZ)(ye,{dashboardTitle:e.title,widget:n,onAdd:function(n){t([...e.widgets,n])},onUpdate:function(n){if(!m)return;const i=[...e.widgets];i[m]=n,t(i)},onDelete:function(){if(!m)return;const n=[...e.widgets];n.splice(m,1),t(n)},onChangeDataSet:f,goBackLocation:v,isEditing:h}):(0,_.tZ)(Rt,{organization:p,router:l,location:s,dashboardTitle:e.title,params:r,goBackLocation:v,onChangeDataSet:f}):(0,_.tZ)(o.Z,{type:"error",icon:(0,_.tZ)(d.FC,{}),children:(0,a.t)("Data set not found.")})}Nt.displayName="WidgetBuilder";const Lt=Nt;function Vt({organization:e,...t}){return(0,_.tZ)(r.Z,{features:["metrics","dashboards-edit"],organization:e,renderDisabled:()=>(0,_.tZ)(s.JH,{children:(0,_.tZ)(o.Z,{type:"warning",children:(0,a.t)("You don't have access to this feature")})}),children:(0,_.tZ)(Lt,{...t,organization:e})})}Vt.displayName="WidgetBuilderContainer";const It=(0,l.Z)(Vt)},"../node_modules/lodash/_baseMean.js":(e,t,n)=>{var i=n("../node_modules/lodash/_baseSum.js");e.exports=function(e,t){var n=null==e?0:e.length;return n?i(e,t)/n:NaN}},"../node_modules/lodash/_baseSum.js":e=>{e.exports=function(e,t){for(var n,i=-1,r=e.length;++i<r;){var o=t(e[i]);void 0!==o&&(n=void 0===n?o:n+o)}return n}},"../node_modules/lodash/mean.js":(e,t,n)=>{var i=n("../node_modules/lodash/_baseMean.js"),r=n("../node_modules/lodash/identity.js");e.exports=function(e){return i(e,r)}}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_widget_index_tsx-node_modules_lodash_mean_js.31e26be924211676adff19f84133ccd2.js.map