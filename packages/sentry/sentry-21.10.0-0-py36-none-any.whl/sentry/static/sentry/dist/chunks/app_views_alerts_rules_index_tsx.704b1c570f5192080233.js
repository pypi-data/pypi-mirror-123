"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/views/alerts/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("./app/icons/index.tsx"),r=s("./app/locale.tsx"),i=s("./app/styles/space.tsx"),o=s("./app/views/alerts/types.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d({status:e,hideText:t=!1,isIssue:s}){let n=(0,r.t)("Resolved"),i=a.DL,d="green300";return s?(n=(0,r.t)("Issue"),i=a.XI,d="gray300"):e===o.vt.CRITICAL?(n=(0,r.t)("Critical"),i=a.zC,d="red300"):e===o.vt.WARNING&&(n=(0,r.t)("Warning"),i=a.FC,d="yellow300"),(0,l.BX)(p,{displayFlex:!t,children:[(0,l.tZ)(u,{color:d,icon:i,children:(0,l.tZ)(i,{color:"white"})}),!t&&(0,l.tZ)(m,{color:d,children:n})]})}d.displayName="AlertBadge";const c=d,p=(0,n.Z)("div",{target:"e1ov36c52"})("display:",(e=>e.displayFlex?"flex":"block"),";align-items:center;"),u=(0,n.Z)("div",{target:"e1ov36c51"})("display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:",(e=>e.icon===a.FC?void 0:1),";left:3px;min-width:30px;&:before{content:'';position:absolute;width:22px;height:22px;border-radius:",(e=>e.theme.borderRadius),";background-color:",(e=>e.theme[e.color]),";transform:rotate(45deg);}svg{width:",(e=>e.icon===a.XI?"11px":"13px"),";z-index:1;}"),m=(0,n.Z)("div",{target:"e1ov36c50"})("margin-left:",(0,i.Z)(1),";color:",(e=>e.theme[e.color]),";")},"./app/views/alerts/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ce});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),i=s("../node_modules/lodash/flatten.js"),o=s.n(i),l=s("./app/actionCreators/indicator.tsx"),d=s("./app/components/asyncComponent.tsx"),c=s("./app/components/layouts/thirds.tsx"),p=s("./app/components/links/externalLink.tsx"),u=s("./app/components/links/link.tsx"),m=s("./app/components/organizations/globalSelectionHeader/index.tsx"),h=s("./app/components/pagination.tsx"),g=s("./app/components/panels/index.tsx"),Z=s("./app/components/searchBar.tsx"),x=s("./app/components/sentryDocumentTitle.tsx"),v=s("./app/icons/index.tsx"),y=s("./app/locale.tsx"),w=s("./app/styles/space.tsx"),f=s("./app/utils/analytics.tsx"),b=s("./app/utils/projects.tsx"),I=s("./app/utils/withGlobalSelection.tsx"),A=s("./app/utils/withTeams.tsx"),C=s("./app/views/alerts/list/header.tsx"),q=s("./app/views/alerts/utils/index.tsx"),B=s("../node_modules/lodash/memoize.js"),L=s.n(B),j=s("./app/components/acl/access.tsx"),z=s("./app/components/actions/menuItemActionLink.tsx"),T=s("./app/components/avatar/actorAvatar.tsx"),_=s("./app/components/button.tsx"),k=s("./app/components/buttonBar.tsx"),R=s("./app/components/confirm.tsx"),D=s("./app/components/dateTime.tsx"),S=s("./app/components/dropdownLink.tsx"),E=s("./app/components/errorBoundary.tsx"),X=s("./app/components/idBadge/index.tsx"),N=s("./app/components/timeSince.tsx"),G=s("./app/components/tooltip.tsx"),F=s("./app/styles/overflowEllipsis.tsx"),P=s("./app/utils/getDynamicText.tsx"),V=s("./app/views/alerts/incidentRules/types.tsx"),O=s("./app/views/alerts/alertBadge.tsx"),M=s("./app/views/alerts/types.tsx"),W=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class Y extends r.Component{constructor(...e){super(...e),(0,n.Z)(this,"getProject",L()(((e,t)=>t.find((t=>t.slug===e)))))}activeIncident(){var e;const{rule:t}=this.props;return void 0!==(null===(e=t.latestIncident)||void 0===e?void 0:e.status)&&[M.vt.CRITICAL,M.vt.WARNING].includes(t.latestIncident.status)}renderLastIncidentDate(){const{rule:e}=this.props;return(0,q.Gm)(e)?null:e.latestIncident?this.activeIncident()?(0,W.BX)("div",{children:[(0,y.t)("Triggered "),(0,W.tZ)(N.Z,{date:e.latestIncident.dateCreated})]}):(0,W.BX)("div",{children:[(0,y.t)("Resolved "),(0,W.tZ)(N.Z,{date:e.latestIncident.dateClosed})]}):"-"}renderAlertRuleStatus(){var e,t;const{rule:s}=this.props;if((0,q.Gm)(s))return null;const n=this.activeIncident(),a=s.triggers.find((({label:e})=>"critical"===e)),r=s.triggers.find((({label:e})=>"warning"===e)),i=s.resolveThreshold,o=n&&(null===(e=s.latestIncident)||void 0===e?void 0:e.status)===M.vt.CRITICAL?a:null!=r?r:a;let l,d="green300",c=n&&s.thresholdType===V.lT.ABOVE?(0,y.t)("Above"):(0,y.t)("Below");return n?(d="critical"===(null==o?void 0:o.label)?"red300":"warning"===(null==o?void 0:o.label)?"yellow300":"green300",l=s.thresholdType===V.lT.ABOVE?"up":"down"):(l=s.thresholdType===V.lT.ABOVE?"down":"up",c=s.thresholdType===V.lT.ABOVE?(0,y.t)("Below"):(0,y.t)("Above")),(0,W.BX)(H,{children:[(0,W.tZ)(v.CC,{color:d,direction:l}),(0,W.tZ)(se,{children:"".concat(c," ").concat(s.latestIncident||!s.latestIncident&&!i?null==o||null===(t=o.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==i?void 0:i.toLocaleString())})]})}render(){var e,t,s,n;const{rule:a,projectsLoaded:i,projects:o,orgId:l,onDelete:d,userTeams:c}=this.props,p=a.projects[0],m="/organizations/".concat(l,"/alerts/").concat((0,q.Gm)(a)?"rules":"metric-rules","/").concat(p,"/").concat(a.id,"/"),h="/organizations/".concat(l,"/alerts/rules/details/").concat(a.id,"/"),g=null===(e=a.owner)||void 0===e?void 0:e.split(":")[1],Z=g?{type:"team",id:g,name:""}:null,x=!g||c.has(g),w=(0,q.Gm)(a)?a.name:(0,W.tZ)(K,{to:(0,q.Gm)(a)?m:h,children:a.name}),f={[M.vt.CRITICAL]:(0,y.t)("Critical"),[M.vt.WARNING]:(0,y.t)("Warning"),[M.vt.CLOSED]:(0,y.t)("Resolved"),[M.vt.OPENED]:(0,y.t)("Resolved")};return(0,W.BX)(E.Z,{children:[(0,W.BX)(U,{isIssueAlert:(0,q.Gm)(a),children:[(0,W.tZ)(H,{children:(0,W.tZ)(G.Z,{title:(0,q.Gm)(a)?(0,y.t)("Issue Alert"):(0,y._N)("Metric Alert Status: [status]",{status:f[null!==(t=null==a||null===(s=a.latestIncident)||void 0===s?void 0:s.status)&&void 0!==t?t:M.vt.CLOSED]}),children:(0,W.tZ)(O.Z,{status:null==a||null===(n=a.latestIncident)||void 0===n?void 0:n.status,isIssue:(0,q.Gm)(a),hideText:!0})})}),(0,W.BX)(J,{children:[(0,W.tZ)(Q,{children:w}),!(0,q.Gm)(a)&&this.renderLastIncidentDate()]})]}),(0,W.tZ)(H,{children:this.renderAlertRuleStatus()}),(0,W.tZ)(H,{children:(0,W.tZ)($,{children:(0,W.tZ)(ee,{avatarSize:18,project:i?this.getProject(p,o):{slug:p}})})}),(0,W.tZ)(H,{children:Z?(0,W.tZ)(T.Z,{actor:Z,size:24}):"-"}),(0,W.tZ)(H,{children:(0,W.tZ)(te,{date:(0,P.Z)({value:a.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,W.tZ)(re,{children:(0,W.tZ)(j.Z,{access:["alerts:write"],children:({hasAccess:e})=>(0,W.BX)(r.Fragment,{children:[(0,W.tZ)(ae,{children:(0,W.BX)(S.Z,{anchorRight:!0,caret:!1,title:(0,W.tZ)(_.ZP,{tooltipProps:{containerDisplayMode:"flex"},size:"small",type:"button","aria-label":(0,y.t)("Show more"),icon:(0,W.tZ)(v.YR,{size:"xs"})}),children:[(0,W.tZ)("li",{children:(0,W.tZ)(u.Z,{to:m,children:(0,y.t)("Edit")})}),(0,W.tZ)(R.Z,{disabled:!e||!x,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:a.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>d(p,a),children:(0,W.tZ)(z.Z,{title:(0,y.t)("Delete"),children:(0,y.t)("Delete")})})]})}),(0,W.BX)(ne,{gap:1,children:[(0,W.tZ)(R.Z,{disabled:!e||!x,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:a.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>d(p,a),children:(0,W.tZ)(_.ZP,{type:"button",icon:(0,W.tZ)(v.Fz,{}),size:"small",title:(0,y.t)("Delete")})}),(0,W.tZ)(G.Z,{title:(0,y.t)("Edit"),children:(0,W.tZ)(_.ZP,{size:"small",type:"button",icon:(0,W.tZ)(v.iC,{}),to:m})})]})]})})})]})}}Y.displayName="RuleListRow";const K=(0,a.Z)(u.Z,{target:"e1f6xqs311"})(F.Z,";"),H=(0,a.Z)("div",{target:"e1f6xqs310"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),U=(0,a.Z)(H,{target:"e1f6xqs39"})((e=>e.isIssueAlert&&"padding: ".concat((0,w.Z)(3)," ").concat((0,w.Z)(2),"; line-height: 2.4;")),";"),J=(0,a.Z)("div",{target:"e1f6xqs38"})(F.Z," margin-left:",(0,w.Z)(1.5),";line-height:1.35;"),Q=(0,a.Z)("div",{target:"e1f6xqs37"})(F.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),$=(0,a.Z)("div",{target:"e1f6xqs36"})({name:"1d3w5wq",styles:"width:100%"}),ee=(0,a.Z)(X.Z,{target:"e1f6xqs35"})({name:"ozd7xs",styles:"flex-shrink:0"}),te=(0,a.Z)(D.Z,{target:"e1f6xqs34"})({name:"kow0uz",styles:"font-variant-numeric:tabular-nums"}),se=(0,a.Z)("div",{target:"e1f6xqs33"})("margin-left:",(0,w.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),ne=(0,a.Z)(k.ZP,{target:"e1f6xqs32"})("display:none;justify-content:flex-start;align-items:center;@media (max-width: ",(e=>e.theme.breakpoints[1]),"){display:flex;}"),ae=(0,a.Z)("div",{target:"e1f6xqs31"})("display:none;@media (min-width: ",(e=>e.theme.breakpoints[1]),"){display:block;}"),re=(0,a.Z)(H,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,w.Z)(1),";"),ie=Y;var oe=s("./app/views/alerts/rules/teamFilter.tsx");class le extends d.Z{constructor(...e){super(...e),(0,n.Z)(this,"handleChangeFilter",((e,t)=>{const{router:s,location:n}=this.props,{cursor:a,page:r,...i}=n.query,o=[...t];s.push({pathname:n.pathname,query:{...i,team:o.length?o:""}})})),(0,n.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:n,page:a,...r}=s.query;t.push({pathname:s.pathname,query:{...r,name:e}})})),(0,n.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:s}=this.props,{orgId:n}=s,a=(0,q.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise("/projects/".concat(n,"/").concat(e,"/").concat(a,"/").concat(t.id,"/"),{method:"DELETE"}),this.reloadData()}catch(e){(0,l.Iw)((0,y.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident"],s.team=(0,oe.L)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList","/organizations/".concat(e&&e.orgId,"/combined-rules/"),{query:s}]]}renderLoading(){return this.renderBody()}renderFilterBar(){var e;const{teams:t,location:s}=this.props,n=new Set((0,oe.L)(s.query.team));return(0,W.BX)(me,{children:[(0,W.tZ)(oe.Z,{teams:t,selectedTeams:n,handleChangeFilter:this.handleChangeFilter}),(0,W.tZ)(he,{placeholder:(0,y.t)("Search by name"),query:null===(e=s.query)||void 0===e?void 0:e.name,onSearch:this.handleChangeSearch})]})}renderList(){const{params:{orgId:e},location:{query:t},organization:s,teams:n}=this.props,{loading:a,ruleList:r=[],ruleListPageLinks:i}=this.state,l=new Set(o()(null==r?void 0:r.map((({projects:e})=>e)))),d={asc:"1"===t.asc,field:t.sort||"date_added"},{cursor:u,page:m,...g}=t,Z=d.field.includes("incident_status")||d.field.includes("date_triggered"),x=(0,W.tZ)(v.CC,{color:"gray300",size:"xs",direction:d.asc?"up":"down"}),w=new Set(n.filter((({isMember:e})=>e)).map((({id:e})=>e)));return(0,W.tZ)(pe,{children:(0,W.BX)(c.or,{fullWidth:!0,children:[this.renderFilterBar(),(0,W.tZ)(ge,{headers:[(0,W.BX)(ue,{to:{pathname:location.pathname,query:{...g,asc:"name"===d.field&&d.asc?void 0:"1",sort:"name"}},children:[(0,y.t)("Alert Rule")," ","name"===d.field&&x]},"name"),(0,W.BX)(ue,{to:{pathname:location.pathname,query:{...g,asc:Z&&!d.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,y.t)("Status")," ",Z&&x]},"status"),(0,y.t)("Project"),(0,y.t)("Team"),(0,W.BX)(ue,{to:{pathname:location.pathname,query:{...g,asc:"date_added"!==d.field||d.asc?void 0:"1",sort:"date_added"}},children:[(0,y.t)("Created")," ","date_added"===d.field&&x]},"dateAdded"),(0,y.t)("Actions")],isLoading:a,isEmpty:0===(null==r?void 0:r.length),emptyMessage:(0,y.t)("No alert rules found for the current query."),emptyAction:(0,W.tZ)(Ze,{children:(0,y._N)("Learn more about [link:Alerts]",{link:(0,W.tZ)(p.Z,{href:"https://docs.sentry.io/product/alerts-notifications/metric-alerts/"})})}),children:(0,W.tZ)(b.Z,{orgId:e,slugs:Array.from(l),children:({initiallyLoaded:t,projects:n})=>r.map((a=>(0,W.tZ)(ie,{projectsLoaded:t,projects:n,rule:a,orgId:e,onDelete:this.handleDeleteRule,organization:s,userTeams:w},"".concat((0,q.Gm)(a)?"metric":"issue","-").concat(a.id))))})}),(0,W.tZ)(h.Z,{pageLinks:i})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:n}=e;return(0,W.tZ)(x.Z,{title:(0,y.t)("Alerts"),orgSlug:n,children:(0,W.BX)(m.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,children:[(0,W.tZ)(C.Z,{organization:t,router:s,activeTab:"rules"}),this.renderList()]})})}}class de extends r.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:n}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=n.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,f.ec)({eventKey:"alert_rules.viewed",eventName:"Alert Rules: Viewed",organization_id:e.id,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,W.tZ)(le,{...this.props})}}de.displayName="AlertRulesListContainer";const ce=(0,I.Z)((0,A.Z)(de)),pe=(0,a.Z)(c.uT,{target:"eddauwb5"})({name:"108qp7n",styles:"margin-bottom:-20px"}),ue=(0,a.Z)(u.Z,{target:"eddauwb4"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),me=(0,a.Z)("div",{target:"eddauwb3"})("display:flex;margin-bottom:",(0,w.Z)(1.5),";"),he=(0,a.Z)(Z.Z,{target:"eddauwb2"})("flex-grow:1;margin-left:",(0,w.Z)(1.5),";"),ge=(0,a.Z)(g.KB,{target:"eddauwb1"})("overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:auto 1.5fr 1fr 1fr 1fr auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";"),Ze=(0,a.Z)("p",{target:"eddauwb0"})("font-size:",(e=>e.theme.fontSizeLarge),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.924981bada974420927f495479a228ae.js.map