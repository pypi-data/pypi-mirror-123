"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_actionCreators_dashboards_tsx-app_views_dashboardsV2_widget_utils_tsx-app_views_dashboard-26458f"],{"./app/actionCreators/dashboards.tsx":(e,t,s)=>{s.d(t,{JR:()=>a,a_:()=>n,AK:()=>i,Y:()=>l,iM:()=>d,QL:()=>c});var o=s("./app/actionCreators/indicator.tsx"),r=s("./app/locale.tsx");function a(e,t,s,a){const{title:n,widgets:i}=s,l=e.requestPromise("/organizations/".concat(t,"/dashboards/"),{method:"POST",data:{title:n,widgets:i,duplicate:a}});return l.catch((e=>{var t;const s=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;s?(0,o.Iw)(s):(0,o.Iw)((0,r.t)("Unable to create dashboard"))})),l}function n(e,t,s){return e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(s,"/visit/"),{method:"POST"})}function i(e,t,s){const a=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(s,"/"),{method:"GET"});return a.catch((e=>{var t;const s=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;s?(0,o.Iw)(s):(0,o.Iw)((0,r.t)("Unable to load dashboard"))})),a}function l(e,t,s){const a={title:s.title,widgets:s.widgets},n=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(s.id,"/"),{method:"PUT",data:a});return n.catch((e=>{var t;const s=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;s?(0,o.Iw)(s):(0,o.Iw)((0,r.t)("Unable to update dashboard"))})),n}function d(e,t,s){const a=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(s,"/"),{method:"DELETE"});return a.catch((e=>{var t;const s=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;s?(0,o.Iw)(s):(0,o.Iw)((0,r.t)("Unable to delete dashboard"))})),a}function c(e,t,s){return e.requestPromise("/organizations/".concat(t,"/dashboards/widgets/"),{method:"POST",data:s})}},"./app/components/charts/components/visualMap.tsx":(e,t,s)=>{function o(e){return e}s.d(t,{Z:()=>o}),s("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/transitionChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("./app/components/charts/loadingPanel.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends r.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const s=t.prevReloading,o=e.reloading,r=t.prevLoading,a=e.loading;return r!==a?{prevReloading:o,prevLoading:a,key:t.key+1}:a?{prevReloading:o,prevLoading:a,key:t.key}:s&&!o?{prevReloading:o,prevLoading:a,key:t.key+1}:{prevReloading:o,prevLoading:a,key:t.key}}render(){const{height:e,loading:t,reloading:s}=this.props;return t&&!s?(0,n.tZ)(a.Z,{height:e,"data-test-id":"events-request-loading"}):(0,n.tZ)(r.Fragment,{children:this.props.children},String(this.state.key))}}i.displayName="TransitionChart",(0,o.Z)(i,"defaultProps",{height:"200px"});const l=i},"./app/views/dashboardsV2/types.tsx":(e,t,s)=>{s.d(t,{ZU:()=>o,FO:()=>r,n3:()=>a});const o=30;let r,a;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(r||(r={})),function(e){e.VIEW="view",e.EDIT="edit",e.CREATE="create",e.PENDING_DELETE="pending_delete"}(a||(a={}))},"./app/views/dashboardsV2/utils.tsx":(e,t,s)=>{s.d(t,{qk:()=>c,tT:()=>p,y1:()=>h}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/lodash/cloneDeep.js"),r=s.n(o),a=s("../node_modules/lodash/pick.js"),n=s.n(a),i=s("./app/utils/dates.tsx"),l=s("./app/utils/discover/eventView.tsx"),d=s("./app/views/dashboardsV2/types.tsx");function c(e){return r()(e)}function p(e,t,s,o){const{start:r,end:a,period:n}=s.datetime,{projects:c,environments:p}=s,u=o===d.FO.WORLD_MAP?["geo.country_code",...t.fields]:t.fields,h=o===d.FO.WORLD_MAP?"".concat(t.conditions," has:geo.country_code"):t.conditions;return l.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:u,query:h,orderby:t.orderby,projects:c,range:n,start:r?(0,i.v5)(r):void 0,end:a?(0,i.v5)(a):void 0,environment:p})}function u(e){return"string"==typeof e?[e]:e}function h(e){if(e){const t=u(e.queryNames),s=u(e.queryConditions),o=u(e.queryFields),r=[];if(s&&t&&o&&"string"==typeof e.queryOrderby&&s.forEach(((s,a)=>{r.push({name:t[a],conditions:s,fields:o,orderby:e.queryOrderby})})),e.title&&e.displayType&&e.interval&&r.length>0)return{...n()(e,["title","displayType","interval"]),queries:r}}}},"./app/views/dashboardsV2/widget/utils.tsx":(e,t,s)=>{s.d(t,{FO:()=>r,qg:()=>a,hV:()=>n});var o=s("./app/locale.tsx");let r,a;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(r||(r={})),function(e){e.EVENTS="events",e.METRICS="metrics"}(a||(a={}));const n={[r.AREA]:(0,o.t)("Area Chart"),[r.BAR]:(0,o.t)("Bar Chart"),[r.LINE]:(0,o.t)("Line Chart"),[r.TABLE]:(0,o.t)("Table"),[r.WORLD_MAP]:(0,o.t)("World Map"),[r.BIG_NUMBER]:(0,o.t)("Big Number"),[r.TOP_N]:(0,o.t)("Top Events")}},"./app/views/dashboardsV2/widgetCard.tsx":(e,t,s)=>{s.d(t,{Z:()=>Ze});var o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),a=s("../node_modules/react-lazyload/lib/index.js"),n=s("../node_modules/react-router/es/index.js"),i=s("../node_modules/lodash/isEqual.js"),l=s.n(i),d=s("./app/actionCreators/modal.tsx"),c=s("./app/components/charts/styles.tsx"),p=s("./app/components/errorBoundary.tsx"),u=s("./app/components/menuItem.tsx"),h=s("./app/components/organizations/globalSelectionHeader/utils.tsx"),g=s("./app/components/panels/index.tsx"),m=s("./app/components/placeholder.tsx"),b=s("./app/icons/index.tsx"),v=s("./app/locale.tsx"),y=s("./app/styles/overflowEllipsis.tsx"),f=s("./app/styles/space.tsx"),Z=s("./app/utils/analytics.tsx"),x=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),w=s("./app/utils/withApi.tsx"),_=s("./app/utils/withGlobalSelection.tsx"),C=s("./app/utils/withOrganization.tsx"),T=s("./app/views/dashboardsV2/utils.tsx"),R=s("./app/views/dashboardsV2/contextMenu.tsx"),q=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),j=s("./app/components/charts/areaChart.tsx"),E=s("./app/components/charts/barChart.tsx"),M=s("./app/components/charts/chartZoom.tsx"),A=s("./app/components/charts/errorPanel.tsx"),S=s("./app/components/charts/lineChart.tsx"),k=s("./app/components/panels/panelTable.tsx"),D=s("./app/utils/discover/fieldRenderers.tsx"),z=s("./app/utils/discover/fields.tsx"),N=s("./app/views/eventsV2/utils.tsx"),O=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class P extends r.Component{renderRow(e,t,s,o){const{location:r,organization:a}=this.props;return o.map((o=>{const n=(0,D.Js)(o.name,s)(t,{organization:a,location:r});return(0,O.tZ)(B,{children:n},"".concat(e,":").concat(o.name))}))}render(){const{className:e,loading:t,fields:s,metadata:o,data:a,title:n}=this.props,i=null!=o?o:{},l=(0,N.Hg)(s.map((e=>({field:e}))));return(0,O.BX)(r.Fragment,{children:[n&&(0,O.tZ)("h4",{children:n}),(0,O.tZ)(I,{className:e,isLoading:t,headers:l.map(((e,t)=>{const s=(0,z.qG)(e.name,e.type,i);return(0,O.tZ)(L,{align:s,children:e.name},t)})),isEmpty:!(null!=a&&a.length),disablePadding:!0,children:null==a?void 0:a.map(((e,t)=>this.renderRow(t,e,i,l)))})]})}}P.displayName="SimpleTableChart";const I=(0,o.Z)(k.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",k.z,"{height:min-content;}"),L=(0,o.Z)("div",{target:"e3tr8vk1"})((e=>e.align?"text-align: ".concat(e.align,";"):"")," padding:",(0,f.Z)(1)," ",(0,f.Z)(3),";"),B=(0,o.Z)("div",{target:"e3tr8vk0"})("padding:",(0,f.Z)(1)," ",(0,f.Z)(3),";"),F=(0,C.Z)(P);var W=s("./app/components/charts/transitionChart.tsx"),U=s("./app/components/charts/transparentLoadingMask.tsx"),V=s("./app/components/charts/utils.tsx"),X=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),J=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/echarts/index.js")),G=s.n(J),Q=s("../node_modules/lodash/max.js"),K=s.n(Q),H=s("./app/components/charts/components/visualMap.tsx");s("../node_modules/echarts/lib/chart/map.js");var Y=s("./app/components/charts/baseChart.tsx");class $ extends r.Component{constructor(...e){super(...e),(0,X.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([s.e("app_data_countryCodesMap_tsx").then(s.bind(s,"./app/data/countryCodesMap.tsx")),s.e("app_data_world_json").then(s.t.bind(s,"./app/data/world.json",19))]);G().registerMap("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:s,seriesOptions:o,theme:r,...a}=this.props,n=s.map((({seriesName:e,data:t,...s})=>{var a;return function(e={}){return{roam:!0,itemStyle:{emphasis:{label:{show:!1}}},...e,type:"map"}}({...o,...s,map:"sentryWorld",name:e,nameMap:null!==(a=this.state.countryToCodeMap)&&void 0!==a?a:void 0,aspectScale:.85,zoom:1.3,center:[10.97,9.71],itemStyle:{areaColor:r.gray200,borderColor:r.backgroundSecondary,emphasis:{areaColor:r.orange300}},label:{emphasis:{show:!1}},data:t})})),i=K()(s.map((({data:e})=>K()(e.map((({value:e})=>e))))))||1;return(0,O.tZ)(Y.Z,{options:{backgroundColor:r.background,visualMap:[(0,H.Z)({left:"right",min:0,max:i,inRange:{color:[r.purple200,r.purple300]},text:["High","Low"],textStyle:{color:r.textColor},calculable:!1})]},...a,yAxis:null,xAxis:null,series:n,tooltip:{formatter:e=>{var t;const{marker:s,name:o,value:r}=Array.isArray(e)?e[0]:e;if(isNaN(r))return"";const a="number"==typeof r?r.toLocaleString():"",n=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[o])||o;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(s," <strong>").concat(n,"</strong></span> ").concat(a,"</div>\n              </div>"),'<div class="tooltip-arrow"></div>'].join("")}}})}}$.displayName="WorldMapChart";const ee=(0,q.b)($);var te=s("./app/components/loadingIndicator.tsx"),se=s("./app/utils/discover/charts.tsx"),oe=s("./app/utils/getDynamicText.tsx");class re extends r.Component{shouldComponentUpdate(e){const t={...this.props,widget:{...this.props.widget,title:""}};return e={...e,widget:{...e.widget,title:""}},!l()(t,e)}tableResultComponent({loading:e,errorMessage:t,tableResults:s}){const{location:o,widget:r,organization:a}=this.props;return t?(0,O.tZ)(A.Z,{children:(0,O.tZ)(b.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,O.tZ)(m.Z,{height:"200px"}):s.map(((t,n)=>{var i,l;const d=null!==(i=null===(l=r.queries[n])||void 0===l?void 0:l.fields)&&void 0!==i?i:[];return(0,O.tZ)(de,{location:o,fields:d,title:s.length>1?t.title:"",loading:e,metadata:t.meta,data:t.data,organization:a},"table:".concat(t.title))}))}bigNumberComponent({loading:e,errorMessage:t,tableResults:s}){return t?(0,O.tZ)(A.Z,{children:(0,O.tZ)(b.FC,{color:"gray500",size:"lg"})}):void 0===s||e?(0,O.tZ)(ie,{children:"—"}):s.map((e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{},o=Object.keys(null!=s?s:{})[0];if(!o||!e.data.length)return(0,O.tZ)(ie,{children:"—"},"big_number:".concat(e.title));const r=e.data[0],a=(0,D.fK)(o,s)(r);return(0,O.tZ)(ie,{children:a},"big_number:".concat(e.title))}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,O.tZ)(E.Z,{...e});case"area":case"top_n":return(0,O.tZ)(j.Z,{stacked:!0,...e});case"world_map":return(0,O.tZ)(ee,{...e});case"line":default:return(0,O.tZ)(S.Z,{...e})}}render(){var e,t,s;const{theme:o,tableResults:r,timeseriesResults:a,errorMessage:n,loading:i,widget:l}=this.props;if("table"===l.displayType)return(0,O.BX)(W.Z,{loading:i,reloading:i,children:[(0,O.tZ)(ne,{loading:i}),this.tableResultComponent({tableResults:r,loading:i,errorMessage:n})]});if("big_number"===l.displayType)return(0,O.BX)(W.Z,{loading:i,reloading:i,children:[(0,O.tZ)(ne,{loading:i}),this.bigNumberComponent({tableResults:r,loading:i,errorMessage:n})]});if(n)return(0,O.tZ)(A.Z,{children:(0,O.tZ)(b.FC,{color:"gray500",size:"lg"})});const{location:d,router:c,selection:p}=this.props,{start:u,end:h,period:g,utc:v}=p.datetime;if("world_map"===l.displayType){const e={title:"",data:[]},t=()=>{var t;if(!r||!r.length)return e;const s=r[0],{data:o,meta:a}=s;if(!o||!o.length||!a)return e;const n=Object.keys(a).find((e=>"geo.country_code"!==e));return n?{title:null!==(t=s.title)&&void 0!==t?t:"",data:o.filter((e=>e["geo.country_code"])).map((e=>({name:e["geo.country_code"],value:e[n]})))}:e},{data:s,title:o}=t(),a=[{seriesName:o,data:s}];return(0,O.BX)(W.Z,{loading:i,reloading:i,children:[(0,O.tZ)(ne,{loading:i}),(0,O.tZ)(le,{children:(0,oe.Z)({value:this.chartComponent({series:a}),fixed:(0,O.tZ)(m.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const y={left:0,top:0,selected:(0,V.RI)(d),formatter:e=>{const t=(0,z.hW)(e);if(null!==t){const s=(0,z.b8)(t);null!==s&&(e=s.toUpperCase())}return(0,z.by)(e)&&(e=(0,z.bQ)(e)),e}},f=null!==(e=null===(t=l.queries[0])||void 0===t||null===(s=t.fields)||void 0===s?void 0:s[0])&&void 0!==e?e:"count()",Z={grid:{left:4,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:se.CX},yAxis:{axisLabel:{color:o.chartLabel,formatter:e=>(0,se.gu)(e,f)}}};return(0,O.tZ)(M.Z,{router:c,period:g,start:u,end:h,utc:v,children:e=>{if(n)return(0,O.tZ)(A.Z,{children:(0,O.tZ)(b.FC,{color:"gray500",size:"lg"})});const t=a?o.charts.getColorPalette(a.length-2):[];"top_n"===l.displayType&&a&&a.length>5&&(t[t.length-1]=o.chartOther);const s=a?a.map(((e,s)=>({...e,color:t[s]}))):[];return(0,O.BX)(W.Z,{loading:i,reloading:i,children:[(0,O.tZ)(ne,{loading:i}),(0,O.tZ)(le,{children:(0,oe.Z)({value:this.chartComponent({...e,...Z,legend:y,series:s}),fixed:(0,O.tZ)(m.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}re.displayName="WidgetCardChart";const ae=(0,o.Z)((e=>(0,O.tZ)(U.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e1od7x483"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),ne=({loading:e})=>e?(0,O.tZ)(ae,{visible:e,children:(0,O.tZ)(te.Z,{mini:!0})}):null;ne.displayName="LoadingScreen";const ie=(0,o.Z)("div",{target:"e1od7x482"})("font-size:32px;padding:",(0,f.Z)(1)," ",(0,f.Z)(3)," ",(0,f.Z)(3)," ",(0,f.Z)(3),";*{text-align:left!important;}"),le=(0,o.Z)("div",{target:"e1od7x481"})("padding:0 ",(0,f.Z)(3)," ",(0,f.Z)(3),";"),de=(0,o.Z)(F,{target:"e1od7x480"})("margin-top:",(0,f.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),ce=(0,q.b)(re);s("../node_modules/core-js/modules/es.symbol.description.js");var pe=s("./app/actionCreators/events.tsx"),ue=s("./app/utils/dates.tsx"),he=s("./app/utils/discover/genericDiscoverQuery.tsx"),ge=s("./app/utils/discover/types.tsx");function me(e,t){return{seriesName:t,data:e.data.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}}function be(e,t){let s=[];const o=e.name;if((0,V.Xe)(t)){const e=Object.keys(t).map((e=>{const s=o?"".concat(o," : ").concat(e):e,r=t[e];return[r.order||0,me(r,s)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));s=s.concat(e)}else{const r=e.fields[0],a=o?"".concat(o," : ").concat(r):r,n=me(t,a);s.push(n)}return s}class ve extends r.Component{constructor(...e){super(...e),(0,X.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0})}componentDidMount(){this.fetchData()}componentDidUpdate(e){var t;const{selection:s,widget:o}=this.props,[r,a]=e.widget.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]),[n,i]=o.queries.map((e=>(e.fields=e.fields.filter((e=>!!e&&"equation|"!==e)),e))).reduce((([e,t],{name:s,...o})=>(e.push(s),t.push(o),[e,t])),[[],[]]);l()(o.displayType,e.widget.displayType)&&l()(o.interval,e.widget.interval)&&l()(i,a)&&l()(o.displayType,e.widget.displayType)&&(0,h.WO)(s,e.selection)?this.state.loading||l()(r,n)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==o.queries.length||this.setState((e=>{const t=o.queries.reduce(((t,s,o)=>t.concat(be(s,e.rawResults[o]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}fetchEventData(e){const{selection:t,api:s,organization:o,widget:r}=this.props;let a=[];this.setState({tableResults:[]});const n=r.queries.map((e=>{const a=(0,T.tT)(r.title,e,t);let n="";const i={per_page:5,noPagination:!0};if("table"===r.displayType)n="/organizations/".concat(o.slug,"/eventsv2/"),i.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)n="/organizations/".concat(o.slug,"/eventsv2/"),i.per_page=1,i.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");n="/organizations/".concat(o.slug,"/events-geo/"),delete i.per_page,i.referrer="api.dashboards.worldmapwidget"}return(0,he.AA)(s,n,{...a.generateQueryStringObject(),...i})}));let i=0;n.forEach((async(t,s)=>{try{var o,l;const[d]=await t,c=d;c.title=null!==(o=null===(l=r.queries[s])||void 0===l?void 0:l.name)&&void 0!==o?o:"",a=[...a,c],this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:a}))}catch(e){var d;const t=(null==e||null===(d=e.responseJSON)||void 0===d?void 0:d.detail)||(0,v.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{i++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:i!==n.length}))}}))}fetchTimeseriesData(e,t){const{selection:s,api:o,organization:r,widget:a}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:n,projects:i}=s,{start:l,end:d,period:c}=s.datetime,p=function(e,t){let s="bar"===e.displayType?"1d":e.interval;s||(s="5m");const o=(0,ue.YJ)(s);return(0,V.Nm)(t)/o>4e3?(0,V.ZS)(t,"high"):s}(a,{start:l,end:d,period:c}),u=a.queries.map((e=>{let s;return"top_n"===a.displayType?(s={organization:r,interval:p,start:l,end:d,project:i,environment:n,period:c,query:e.conditions,yAxis:(0,z.Nk)(e.fields)[0],includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0,topEvents:ge.hY,field:e.fields},e.orderby&&(s.orderby=e.orderby)):s={organization:r,interval:p,start:l,end:d,project:i,environment:n,period:c,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:"api.dashboards.widget.".concat(t,"-chart"),partial:!0},(0,pe.lI)(o,s)}));let h=0;u.forEach((async(t,s)=>{try{const o=await t;this.setState((t=>{var r,n;if(t.queryFetchID!==e)return t;const i=(null!==(r=t.timeseriesResults)&&void 0!==r?r:[]).concat(be(a.queries[s],o));return{...t,timeseriesResults:i,rawResults:(null!==(n=t.rawResults)&&void 0!==n?n:[]).concat(o)}}))}catch(e){var o;const t=(null==e||null===(o=e.responseJSON)||void 0===o?void 0:o.detail)||(0,v.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{h++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:h!==u.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:o,errorMessage:r}=this.state;return e({loading:t,timeseriesResults:s,tableResults:o,errorMessage:r})}}ve.displayName="WidgetQueries";const ye=ve;class fe extends r.Component{shouldComponentUpdate(e){return!l()(e.widget,this.props.widget)||!(0,h.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}isAllowWidgetsToDiscover(){const{organization:e}=this.props;return e.features.includes("connect-discover-and-dashboards")}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:s,hideToolbar:o,isEditing:r}=this.props;return r?(0,O.tZ)(_e,{children:(0,O.BX)(Ce,{style:{visibility:o?"hidden":"visible"},children:[(0,O.tZ)(Te,{children:(0,O.tZ)(Re,{color:"textColor",...null==s?void 0:s.listeners,...null==s?void 0:s.attributes})}),(0,O.tZ)(Te,{"data-test-id":"widget-edit",onClick:()=>{e()},children:(0,O.tZ)(b.yl,{color:"textColor"})}),(0,O.tZ)(Te,{"data-test-id":"widget-delete",onClick:()=>{t()},children:(0,O.tZ)(b.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:s,showContextMenu:o}=this.props;if(!o)return null;const r=[];return("table"===e.displayType||this.isAllowWidgetsToDiscover())&&s.features.includes("discover-basic")&&e.queries.length&&r.push((0,O.tZ)(u.Z,{onClick:o=>{if(o.preventDefault(),(0,Z.ec)({eventKey:"dashboards2.tablewidget.open_in_discover",eventName:"Dashboards2: Table Widget - Open in Discover",organization_id:parseInt(this.props.organization.id,10)}),1===e.queries.length){const o=(0,T.tT)(e.title,e.queries[0],t,e.displayType),r=o.getResultsViewUrlTarget(s.slug);if(this.isAllowWidgetsToDiscover()){const t=o.getYAxisOptions().map((({value:e})=>e));r.query.yAxis=e.queries[0].fields.filter((e=>t.includes(e))).slice(0,3)}n.browserHistory.push(r)}else(0,x.Z)("dashboards_views.query_selector.opened",{organization:s,widget_type:e.displayType}),(0,d.openDashboardWidgetQuerySelectorModal)({organization:s,widget:e})},children:(0,v.t)("Open in Discover")},"open-discover")),r.length?(0,O.tZ)(Ee,{children:(0,O.tZ)(R.Z,{children:r})}):null}render(){const{widget:e,api:t,organization:s,selection:o,renderErrorMessage:n,location:i,router:l}=this.props;return(0,O.tZ)(p.Z,{customComponent:(0,O.tZ)(xe,{children:(0,v.t)("Error loading widget data")}),children:(0,O.BX)(we,{isDragging:!1,children:[(0,O.BX)(je,{children:[(0,O.tZ)(qe,{children:e.title}),this.renderContextMenu()]}),(0,O.tZ)(a.ZP,{once:!0,height:200,children:(0,O.tZ)(ye,{api:t,organization:s,widget:e,selection:o,children:({tableResults:t,timeseriesResults:a,errorMessage:d,loading:c})=>(0,O.BX)(r.Fragment,{children:["function"==typeof n?n(d):null,(0,O.tZ)(ce,{timeseriesResults:a,tableResults:t,errorMessage:d,loading:c,location:i,widget:e,selection:o,router:l,organization:s}),this.renderToolbar()]})})})]})})}}fe.displayName="WidgetCard";const Ze=(0,w.Z)((0,C.Z)((0,_.Z)((0,n.withRouter)(fe)))),xe=(0,o.Z)(m.Z,{target:"emngp8q8"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,f.Z)(2),";"),we=(0,o.Z)(g.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"emngp8q7"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;"),_e=(0,o.Z)("div",{target:"emngp8q6"})("position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),Ce=(0,o.Z)("div",{target:"emngp8q5"})("display:flex;margin:10px ",(0,f.Z)(2),";touch-action:none;"),Te=(0,o.Z)("div",{target:"emngp8q4"})("padding:",(0,f.Z)(1),";&:hover{cursor:pointer;}"),Re=(0,o.Z)(b.LS,{target:"emngp8q3"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),qe=(0,o.Z)(c.Gh,{target:"emngp8q2"})(y.Z,";"),je=(0,o.Z)("div",{target:"emngp8q1"})("padding:",(0,f.Z)(2)," ",(0,f.Z)(3)," 0 ",(0,f.Z)(3),";width:100%;display:flex;justify-content:space-between;"),Ee=(0,o.Z)("div",{target:"emngp8q0"})("margin-left:",(0,f.Z)(1),";")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_dashboards_tsx-app_views_dashboardsV2_widget_utils_tsx-app_views_dashboard-26458f.e554f1baca1cea5fcc8b7ce5470467a0.js.map